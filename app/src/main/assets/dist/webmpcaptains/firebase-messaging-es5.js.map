{"version":3,"sources":["firebase-messaging-es5.js","webpack:///node_modules/@firebase/installations/dist/index.esm.js","webpack:///node_modules/@firebase/messaging/dist/index.esm.js","webpack:///node_modules/firebase/messaging/dist/index.esm.js","webpack:///node_modules/idb/build/idb.js"],"names":[],"mappings":"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","file":"x","sourcesContent":["(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[\"firebase-messaging\"],{\n\n/***/ \"./node_modules/@firebase/installations/dist/index.esm.js\":\n/*!****************************************************************!*\\\n  !*** ./node_modules/@firebase/installations/dist/index.esm.js ***!\n  \\****************************************************************/\n/*! exports provided: registerInstallations */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"registerInstallations\", function() { return registerInstallations; });\n/* harmony import */ var _firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @firebase/app */ \"./node_modules/@firebase/app/dist/index.cjs.js\");\n/* harmony import */ var _firebase_app__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_firebase_app__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.es6.js\");\n/* harmony import */ var _firebase_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @firebase/util */ \"./node_modules/@firebase/util/dist/index.cjs.js\");\n/* harmony import */ var _firebase_util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_firebase_util__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var idb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! idb */ \"./node_modules/idb/build/idb.js\");\n/* harmony import */ var idb__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(idb__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\n\nvar version = \"0.3.6\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new _firebase_util__WEBPACK_IMPORTED_MODULE_2__[\"ErrorFactory\"](SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof _firebase_util__WEBPACK_IMPORTED_MODULE_2__[\"FirebaseError\"] &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__values\"])(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var result;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallation(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__spread\"])(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = Object(idb__WEBPACK_IMPORTED_MODULE_3__[\"openDb\"])(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry, _a;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallation(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthToken(appConfig, installationEntry) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, completedAuthToken;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _a.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _a.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(appConfig, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(appConfig, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(appConfig, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n */\r\nfunction waitUntilAuthTokenRequest(appConfig, forceRefresh) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(appConfig, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(appConfig, installationEntry) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthToken(appConfig, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(app) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var appConfig, _a, installationEntry, registrationPromise;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(appConfig).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(app, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var appConfig, authToken;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, completeInstallationRegistration(appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(appConfig, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(appConfig, installationEntry) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation$1(app) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallation(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    var factoryMethod = function (app) {\r\n        // Throws if app isn't configured properly.\r\n        extractAppConfig(app);\r\n        return {\r\n            app: app,\r\n            getId: function () { return getId(app); },\r\n            getToken: function (forceRefresh) { return getToken(app, forceRefresh); },\r\n            delete: function () { return deleteInstallation$1(app); }\r\n        };\r\n    };\r\n    instance.INTERNAL.registerService(installationsName, factoryMethod);\r\n}\r\nregisterInstallations(_firebase_app__WEBPACK_IMPORTED_MODULE_0___default.a);\n\n\n//# sourceMappingURL=index.esm.js.map\n\n\n/***/ }),\n\n/***/ \"./node_modules/@firebase/messaging/dist/index.esm.js\":\n/*!************************************************************!*\\\n  !*** ./node_modules/@firebase/messaging/dist/index.esm.js ***!\n  \\************************************************************/\n/*! exports provided: isSupported, registerMessaging */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isSupported\", function() { return isSupported; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"registerMessaging\", function() { return registerMessaging; });\n/* harmony import */ var _firebase_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @firebase/app */ \"./node_modules/@firebase/app/dist/index.cjs.js\");\n/* harmony import */ var _firebase_app__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_firebase_app__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ \"./node_modules/tslib/tslib.es6.js\");\n/* harmony import */ var _firebase_util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @firebase/util */ \"./node_modules/@firebase/util/dist/index.cjs.js\");\n/* harmony import */ var _firebase_util__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_firebase_util__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _firebase_installations__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @firebase/installations */ \"./node_modules/@firebase/installations/dist/index.esm.js\");\n\n\n\n\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_MAP = (_a = {},\r\n    _a[\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\r\n    _a[\"only-available-in-sw\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\r\n    _a[\"should-be-overriden\" /* SHOULD_BE_INHERITED */] = 'This method should be overriden by extended classes.',\r\n    _a[\"bad-sender-id\" /* BAD_SENDER_ID */] = \"Please ensure that 'messagingSenderId' is set \" +\r\n        'correctly in the options passed into firebase.initializeApp().',\r\n    _a[\"permission-default\" /* PERMISSION_DEFAULT */] = 'The required permissions were not granted and dismissed instead.',\r\n    _a[\"permission-blocked\" /* PERMISSION_BLOCKED */] = 'The required permissions were not granted and blocked instead.',\r\n    _a[\"unsupported-browser\" /* UNSUPPORTED_BROWSER */] = \"This browser doesn't support the API's \" +\r\n        'required to use the firebase SDK.',\r\n    _a[\"notifications-blocked\" /* NOTIFICATIONS_BLOCKED */] = 'Notifications have been blocked.',\r\n    _a[\"failed-serviceworker-registration\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the ' +\r\n        'default service worker. {$browserErrorMessage}',\r\n    _a[\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */] = 'A service worker registration was the expected input.',\r\n    _a[\"get-subscription-failed\" /* GET_SUBSCRIPTION_FAILED */] = 'There was an error when trying to get ' +\r\n        'any existing Push Subscriptions.',\r\n    _a[\"invalid-saved-token\" /* INVALID_SAVED_TOKEN */] = 'Unable to access details of the saved token.',\r\n    _a[\"sw-reg-redundant\" /* SW_REG_REDUNDANT */] = 'The service worker being used for push was made redundant.',\r\n    _a[\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occured while subscribing the user to FCM: {$errorInfo}',\r\n    _a[\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\r\n    _a[\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occured while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    _a[\"token-update-failed\" /* TOKEN_UPDATE_FAILED */] = 'A problem occured while updating the user from FCM: {$errorInfo}',\r\n    _a[\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\r\n    _a[\"use-sw-before-get-token\" /* USE_SW_BEFORE_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    _a[\"invalid-delete-token\" /* INVALID_DELETE_TOKEN */] = 'You must pass a valid token into ' +\r\n        'deleteToken(), i.e. the token from getToken().',\r\n    _a[\"delete-token-not-found\" /* DELETE_TOKEN_NOT_FOUND */] = 'The deletion attempt for token could not ' +\r\n        'be performed as the token was not found.',\r\n    _a[\"delete-scope-not-found\" /* DELETE_SCOPE_NOT_FOUND */] = 'The deletion attempt for service worker ' +\r\n        'scope could not be performed as the scope was not found.',\r\n    _a[\"bg-handler-function-expected\" /* BG_HANDLER_FUNCTION_EXPECTED */] = 'The input to setBackgroundMessageHandler() must be a function.',\r\n    _a[\"no-window-client-to-msg\" /* NO_WINDOW_CLIENT_TO_MSG */] = 'An attempt was made to message a non-existant window client.',\r\n    _a[\"unable-to-resubscribe\" /* UNABLE_TO_RESUBSCRIBE */] = 'There was an error while re-subscribing ' +\r\n        'the FCM token for push messaging. Will have to resubscribe the ' +\r\n        'user on next visit. {$errorInfo}',\r\n    _a[\"no-fcm-token-for-resubscribe\" /* NO_FCM_TOKEN_FOR_RESUBSCRIBE */] = 'Could not find an FCM token ' +\r\n        'and as a result, unable to resubscribe. Will have to resubscribe the ' +\r\n        'user on next visit.',\r\n    _a[\"failed-to-delete-token\" /* FAILED_TO_DELETE_TOKEN */] = 'Unable to delete the currently saved token.',\r\n    _a[\"no-sw-in-reg\" /* NO_SW_IN_REG */] = 'Even though the service worker registration was ' +\r\n        'successful, there was a problem accessing the service worker itself.',\r\n    _a[\"bad-scope\" /* BAD_SCOPE */] = 'The service worker scope must be a string with at ' +\r\n        'least one character.',\r\n    _a[\"bad-vapid-key\" /* BAD_VAPID_KEY */] = 'The public VAPID key is not a Uint8Array with 65 bytes.',\r\n    _a[\"bad-subscription\" /* BAD_SUBSCRIPTION */] = 'The subscription must be a valid PushSubscription.',\r\n    _a[\"bad-token\" /* BAD_TOKEN */] = 'The FCM Token used for storage / lookup was not ' +\r\n        'a valid token string.',\r\n    _a[\"failed-delete-vapid-key\" /* FAILED_DELETE_VAPID_KEY */] = 'The VAPID key could not be deleted.',\r\n    _a[\"invalid-public-vapid-key\" /* INVALID_PUBLIC_VAPID_KEY */] = 'The public VAPID key must be a string.',\r\n    _a[\"use-public-key-before-get-token\" /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.',\r\n    _a[\"public-vapid-key-decryption-failed\" /* PUBLIC_KEY_DECRYPTION_FAILED */] = 'The public VAPID key did not equal 65 bytes when decrypted.',\r\n    _a);\r\nvar errorFactory = new _firebase_util__WEBPACK_IMPORTED_MODULE_2__[\"ErrorFactory\"]('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_PUBLIC_VAPID_KEY = new Uint8Array([\r\n    0x04,\r\n    0x33,\r\n    0x94,\r\n    0xf7,\r\n    0xdf,\r\n    0xa1,\r\n    0xeb,\r\n    0xb1,\r\n    0xdc,\r\n    0x03,\r\n    0xa2,\r\n    0x5e,\r\n    0x15,\r\n    0x71,\r\n    0xdb,\r\n    0x48,\r\n    0xd3,\r\n    0x2e,\r\n    0xed,\r\n    0xed,\r\n    0xb2,\r\n    0x34,\r\n    0xdb,\r\n    0xb7,\r\n    0x47,\r\n    0x3a,\r\n    0x0c,\r\n    0x8f,\r\n    0xc4,\r\n    0xcc,\r\n    0xe1,\r\n    0x6f,\r\n    0x3c,\r\n    0x8c,\r\n    0x84,\r\n    0xdf,\r\n    0xab,\r\n    0xb6,\r\n    0x66,\r\n    0x3e,\r\n    0xf2,\r\n    0x0c,\r\n    0xd4,\r\n    0x8b,\r\n    0xfe,\r\n    0xe3,\r\n    0xf9,\r\n    0x76,\r\n    0x2f,\r\n    0x14,\r\n    0x1c,\r\n    0x63,\r\n    0x08,\r\n    0x6a,\r\n    0x6f,\r\n    0x2d,\r\n    0xb1,\r\n    0x1a,\r\n    0x95,\r\n    0xb0,\r\n    0xce,\r\n    0x37,\r\n    0xc0,\r\n    0x9c,\r\n    0x6e\r\n]);\r\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\nvar FN_CAMPAIGN_ID = 'google.c.a.c_id';\r\nvar FN_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nvar FN_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nvar FN_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_MSG_RECEIVED\"] = \"push-msg-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isArrayBufferEqual(a, b) {\r\n    if (a == null || b == null) {\r\n        return false;\r\n    }\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a.byteLength !== b.byteLength) {\r\n        return false;\r\n    }\r\n    var viewA = new DataView(a);\r\n    var viewB = new DataView(b);\r\n    for (var i = 0; i < a.byteLength; i++) {\r\n        if (viewA.getUint8(i) !== viewB.getUint8(i)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction toBase64(arrayBuffer) {\r\n    var uint8Version = new Uint8Array(arrayBuffer);\r\n    return btoa(String.fromCharCode.apply(String, Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__spread\"])(uint8Version)));\r\n}\r\nfunction arrayBufferToBase64(arrayBuffer) {\r\n    var base64String = toBase64(arrayBuffer);\r\n    return base64String\r\n        .replace(/=/g, '')\r\n        .replace(/\\+/g, '-')\r\n        .replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SubscriptionManager = /** @class */ (function () {\r\n    function SubscriptionManager() {\r\n    }\r\n    SubscriptionManager.prototype.getToken = function (app, subscription, vapidKey) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var headers, body, subscribeOptions, responseData, response, err_1, message;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(app)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        body = getBody(subscription, vapidKey);\r\n                        subscribeOptions = {\r\n                            method: 'POST',\r\n                            headers: headers,\r\n                            body: JSON.stringify(body)\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(app), subscribeOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_1 = _a.sent();\r\n                        throw errorFactory.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                            errorInfo: err_1\r\n                        });\r\n                    case 6:\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        if (!responseData.token) {\r\n                            throw errorFactory.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n                        }\r\n                        return [2 /*return*/, responseData.token];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Update the underlying token details for fcmToken.\r\n     */\r\n    SubscriptionManager.prototype.updateToken = function (tokenDetails, app, subscription, vapidKey) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var headers, body, updateOptions, responseData, response, err_2, message;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(app)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        body = getBody(subscription, vapidKey);\r\n                        updateOptions = {\r\n                            method: 'PATCH',\r\n                            headers: headers,\r\n                            body: JSON.stringify(body)\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(app) + \"/\" + tokenDetails.fcmToken, updateOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_2 = _a.sent();\r\n                        throw errorFactory.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                            errorInfo: err_2\r\n                        });\r\n                    case 6:\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        if (!responseData.token) {\r\n                            throw errorFactory.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n                        }\r\n                        return [2 /*return*/, responseData.token];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SubscriptionManager.prototype.deleteToken = function (app, tokenDetails) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var headers, unsubscribeOptions, response, responseData, message, err_3;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(app)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        unsubscribeOptions = {\r\n                            method: 'DELETE',\r\n                            headers: headers\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(app) + \"/\" + tokenDetails.fcmToken, unsubscribeOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_3 = _a.sent();\r\n                        throw errorFactory.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                            errorInfo: err_3\r\n                        });\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SubscriptionManager;\r\n}());\r\nfunction getEndpoint(app) {\r\n    return ENDPOINT + \"/projects/\" + app.options.projectId + \"/registrations\";\r\n}\r\nfunction getHeaders(app) {\r\n    return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n        var installations, authToken;\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    installations = app.installations();\r\n                    return [4 /*yield*/, installations.getToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, new Headers({\r\n                            'Content-Type': 'application/json',\r\n                            Accept: 'application/json',\r\n                            'x-goog-api-key': app.options.apiKey,\r\n                            'x-goog-firebase-installations-auth': \"FIS \" + authToken\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getBody(subscription, vapidKey) {\r\n    var p256dh = arrayBufferToBase64(subscription.getKey('p256dh'));\r\n    var auth = arrayBufferToBase64(subscription.getKey('auth'));\r\n    var body = {\r\n        web: {\r\n            endpoint: subscription.endpoint,\r\n            p256dh: p256dh,\r\n            auth: auth\r\n        }\r\n    };\r\n    if (!isArrayBufferEqual(vapidKey.buffer, DEFAULT_PUBLIC_VAPID_KEY.buffer)) {\r\n        body.web.applicationPubKey = arrayBufferToBase64(vapidKey);\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction base64ToArrayBuffer(base64String) {\r\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    var rawData = atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar OLD_DB_NAME = 'undefined';\r\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nfunction handleDb(db, app) {\r\n    if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n        // We found a database with the name 'undefined', but our expected object\r\n        // store isn't defined.\r\n        return;\r\n    }\r\n    var transaction = db.transaction(OLD_OBJECT_STORE_NAME);\r\n    var objectStore = transaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n    var subscriptionManager = new SubscriptionManager();\r\n    var openCursorRequest = objectStore.openCursor();\r\n    openCursorRequest.onerror = function (event) {\r\n        // NOOP - Nothing we can do.\r\n        console.warn('Unable to cleanup old IDB.', event);\r\n    };\r\n    openCursorRequest.onsuccess = function () {\r\n        var cursor = openCursorRequest.result;\r\n        if (cursor) {\r\n            // cursor.value contains the current record being iterated through\r\n            // this is where you'd do something with the result\r\n            var tokenDetails = cursor.value;\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            subscriptionManager.deleteToken(app, tokenDetails);\r\n            cursor.continue();\r\n        }\r\n        else {\r\n            db.close();\r\n            indexedDB.deleteDatabase(OLD_DB_NAME);\r\n        }\r\n    };\r\n}\r\nfunction cleanV1(app) {\r\n    var request = indexedDB.open(OLD_DB_NAME);\r\n    request.onerror = function (_event) {\r\n        // NOOP - Nothing we can do.\r\n    };\r\n    request.onsuccess = function (_event) {\r\n        var db = request.result;\r\n        handleDb(db, app);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DbInterface = /** @class */ (function () {\r\n    function DbInterface() {\r\n        this.dbPromise = null;\r\n    }\r\n    /** Gets record(s) from the objectStore that match the given key. */\r\n    DbInterface.prototype.get = function (key) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.get(key); });\r\n    };\r\n    /** Gets record(s) from the objectStore that match the given index. */\r\n    DbInterface.prototype.getIndex = function (index, key) {\r\n        function runRequest(objectStore) {\r\n            var idbIndex = objectStore.index(index);\r\n            return idbIndex.get(key);\r\n        }\r\n        return this.createTransaction(runRequest);\r\n    };\r\n    /** Assigns or overwrites the record for the given value. */\r\n    // IndexedDB values are of type \"any\"\r\n    DbInterface.prototype.put = function (value) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.put(value); }, 'readwrite');\r\n    };\r\n    /** Deletes record(s) from the objectStore that match the given key. */\r\n    DbInterface.prototype.delete = function (key) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.delete(key); }, 'readwrite');\r\n    };\r\n    /**\r\n     * Close the currently open database.\r\n     */\r\n    DbInterface.prototype.closeDatabase = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var db;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.dbPromise) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.dbPromise];\r\n                    case 1:\r\n                        db = _a.sent();\r\n                        db.close();\r\n                        this.dbPromise = null;\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Creates an IndexedDB Transaction and passes its objectStore to the\r\n     * runRequest function, which runs the database request.\r\n     *\r\n     * @return Promise that resolves with the result of the runRequest function\r\n     */\r\n    DbInterface.prototype.createTransaction = function (runRequest, mode) {\r\n        if (mode === void 0) { mode = 'readonly'; }\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var db, transaction, request, result;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getDb()];\r\n                    case 1:\r\n                        db = _a.sent();\r\n                        transaction = db.transaction(this.objectStoreName, mode);\r\n                        request = transaction.objectStore(this.objectStoreName);\r\n                        return [4 /*yield*/, promisify(runRequest(request))];\r\n                    case 2:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                                transaction.oncomplete = function () {\r\n                                    resolve(result);\r\n                                };\r\n                                transaction.onerror = function () {\r\n                                    reject(transaction.error);\r\n                                };\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Gets the cached db connection or opens a new one. */\r\n    DbInterface.prototype.getDb = function () {\r\n        var _this = this;\r\n        if (!this.dbPromise) {\r\n            this.dbPromise = new Promise(function (resolve, reject) {\r\n                var request = indexedDB.open(_this.dbName, _this.dbVersion);\r\n                request.onsuccess = function () {\r\n                    resolve(request.result);\r\n                };\r\n                request.onerror = function () {\r\n                    _this.dbPromise = null;\r\n                    reject(request.error);\r\n                };\r\n                request.onupgradeneeded = function (event) { return _this.onDbUpgrade(request, event); };\r\n            });\r\n        }\r\n        return this.dbPromise;\r\n    };\r\n    return DbInterface;\r\n}());\r\n/** Promisifies an IDBRequest. Resolves with the IDBRequest's result. */\r\nfunction promisify(request) {\r\n    return new Promise(function (resolve, reject) {\r\n        request.onsuccess = function () {\r\n            resolve(request.result);\r\n        };\r\n        request.onerror = function () {\r\n            reject(request.error);\r\n        };\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TokenDetailsModel = /** @class */ (function (_super) {\r\n    Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__extends\"])(TokenDetailsModel, _super);\r\n    function TokenDetailsModel(app) {\r\n        var _this = _super.call(this) || this;\r\n        _this.app = app;\r\n        _this.dbName = 'fcm_token_details_db';\r\n        _this.dbVersion = 4;\r\n        _this.objectStoreName = 'fcm_token_object_Store';\r\n        return _this;\r\n    }\r\n    TokenDetailsModel.prototype.onDbUpgrade = function (request, event) {\r\n        var db = request.result;\r\n        // Lack of 'break' statements is intentional.\r\n        switch (event.oldVersion) {\r\n            case 0: {\r\n                // New IDB instance\r\n                var objectStore = db.createObjectStore(this.objectStoreName, {\r\n                    keyPath: 'swScope'\r\n                });\r\n                // Make sure the sender ID can be searched\r\n                objectStore.createIndex('fcmSenderId', 'fcmSenderId', {\r\n                    unique: false\r\n                });\r\n                objectStore.createIndex('fcmToken', 'fcmToken', { unique: true });\r\n            }\r\n            case 1: {\r\n                // Prior to version 2, we were using either 'fcm_token_details_db'\r\n                // or 'undefined' as the database name due to bug in the SDK\r\n                // So remove the old tokens and databases.\r\n                cleanV1(this.app);\r\n            }\r\n            case 2: {\r\n                // Update from v2 to v4 directly in a single openCursor request.\r\n                // We need to do this because for some reason, doing a subsequent update on the same data\r\n                // in the same transaction drops the first update.\r\n                var objectStore = request.transaction.objectStore(this.objectStoreName);\r\n                var cursorRequest_1 = objectStore.openCursor();\r\n                cursorRequest_1.onsuccess = function () {\r\n                    var cursor = cursorRequest_1.result;\r\n                    if (cursor) {\r\n                        var value = cursor.value;\r\n                        var newValue = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, value);\r\n                        if (!value.createTime) {\r\n                            newValue.createTime = Date.now();\r\n                        }\r\n                        if (typeof value.vapidKey === 'string') {\r\n                            newValue.vapidKey = base64ToArrayBuffer(value.vapidKey);\r\n                        }\r\n                        if (typeof value.auth === 'string') {\r\n                            newValue.auth = base64ToArrayBuffer(value.auth).buffer;\r\n                        }\r\n                        if (typeof value.auth === 'string') {\r\n                            newValue.p256dh = base64ToArrayBuffer(value.p256dh).buffer;\r\n                        }\r\n                        if (typeof value.fcmPushSet === 'string') {\r\n                            delete newValue.fcmPushSet;\r\n                        }\r\n                        cursor.update(newValue);\r\n                        cursor.continue();\r\n                    }\r\n                };\r\n                // Break here as we've already updated to v4.\r\n                break;\r\n            }\r\n            case 3: {\r\n                // Update from V3 to V4.\r\n                var objectStore = request.transaction.objectStore(this.objectStoreName);\r\n                var cursorRequest_2 = objectStore.openCursor();\r\n                cursorRequest_2.onsuccess = function () {\r\n                    var cursor = cursorRequest_2.result;\r\n                    if (cursor) {\r\n                        var value = cursor.value;\r\n                        var newValue = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, value);\r\n                        if (typeof value.fcmPushSet === 'string') {\r\n                            delete newValue.fcmPushSet;\r\n                        }\r\n                        cursor.update(newValue);\r\n                        cursor.continue();\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Given a token, this method will look up the details in indexedDB.\r\n     */\r\n    TokenDetailsModel.prototype.getTokenDetailsFromToken = function (fcmToken) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                if (!fcmToken) {\r\n                    throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n                }\r\n                validateInputs({ fcmToken: fcmToken });\r\n                return [2 /*return*/, this.getIndex('fcmToken', fcmToken)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Given a service worker scope, this method will look up the details in\r\n     * indexedDB.\r\n     * @return The details associated with that token.\r\n     */\r\n    TokenDetailsModel.prototype.getTokenDetailsFromSWScope = function (swScope) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                if (!swScope) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                validateInputs({ swScope: swScope });\r\n                return [2 /*return*/, this.get(swScope)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Save the details for the fcm token for re-use at a later date.\r\n     * @param input A plain js object containing args to save.\r\n     */\r\n    TokenDetailsModel.prototype.saveTokenDetails = function (tokenDetails) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                if (!tokenDetails.swScope) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                if (!tokenDetails.vapidKey) {\r\n                    throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n                }\r\n                if (!tokenDetails.endpoint || !tokenDetails.auth || !tokenDetails.p256dh) {\r\n                    throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n                }\r\n                if (!tokenDetails.fcmSenderId) {\r\n                    throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n                }\r\n                if (!tokenDetails.fcmToken) {\r\n                    throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n                }\r\n                validateInputs(tokenDetails);\r\n                return [2 /*return*/, this.put(tokenDetails)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes details of the current FCM token.\r\n     * It's returning a promise in case we need to move to an async\r\n     * method for deleting at a later date.\r\n     *\r\n     * @return Resolves once the FCM token details have been deleted and returns\r\n     * the deleted details.\r\n     */\r\n    TokenDetailsModel.prototype.deleteToken = function (token) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var details;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof token !== 'string' || token.length === 0) {\r\n                            return [2 /*return*/, Promise.reject(errorFactory.create(\"invalid-delete-token\" /* INVALID_DELETE_TOKEN */))];\r\n                        }\r\n                        return [4 /*yield*/, this.getTokenDetailsFromToken(token)];\r\n                    case 1:\r\n                        details = _a.sent();\r\n                        if (!details) {\r\n                            throw errorFactory.create(\"delete-token-not-found\" /* DELETE_TOKEN_NOT_FOUND */);\r\n                        }\r\n                        return [4 /*yield*/, this.delete(details.swScope)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, details];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return TokenDetailsModel;\r\n}(DbInterface));\r\n/**\r\n * This method takes an object and will check for known arguments and\r\n * validate the input.\r\n * @return Promise that resolves if input is valid, rejects otherwise.\r\n */\r\nfunction validateInputs(input) {\r\n    if (input.fcmToken) {\r\n        if (typeof input.fcmToken !== 'string' || input.fcmToken.length === 0) {\r\n            throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n        }\r\n    }\r\n    if (input.swScope) {\r\n        if (typeof input.swScope !== 'string' || input.swScope.length === 0) {\r\n            throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n        }\r\n    }\r\n    if (input.vapidKey) {\r\n        if (!(input.vapidKey instanceof Uint8Array) ||\r\n            input.vapidKey.length !== 65) {\r\n            throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n        }\r\n    }\r\n    if (input.endpoint) {\r\n        if (typeof input.endpoint !== 'string' || input.endpoint.length === 0) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.auth) {\r\n        if (!(input.auth instanceof ArrayBuffer)) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.p256dh) {\r\n        if (!(input.p256dh instanceof ArrayBuffer)) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.fcmSenderId) {\r\n        if (typeof input.fcmSenderId !== 'string' ||\r\n            input.fcmSenderId.length === 0) {\r\n            throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar UNCOMPRESSED_PUBLIC_KEY_SIZE = 65;\r\nvar VapidDetailsModel = /** @class */ (function (_super) {\r\n    Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__extends\"])(VapidDetailsModel, _super);\r\n    function VapidDetailsModel() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.dbName = 'fcm_vapid_details_db';\r\n        _this.dbVersion = 1;\r\n        _this.objectStoreName = 'fcm_vapid_object_Store';\r\n        return _this;\r\n    }\r\n    VapidDetailsModel.prototype.onDbUpgrade = function (request) {\r\n        var db = request.result;\r\n        db.createObjectStore(this.objectStoreName, { keyPath: 'swScope' });\r\n    };\r\n    /**\r\n     * Given a service worker scope, this method will look up the vapid key\r\n     * in indexedDB.\r\n     */\r\n    VapidDetailsModel.prototype.getVapidFromSWScope = function (swScope) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var result;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof swScope !== 'string' || swScope.length === 0) {\r\n                            throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                        }\r\n                        return [4 /*yield*/, this.get(swScope)];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, result ? result.vapidKey : undefined];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Save a vapid key against a swScope for later date.\r\n     */\r\n    VapidDetailsModel.prototype.saveVapidDetails = function (swScope, vapidKey) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var details;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                if (typeof swScope !== 'string' || swScope.length === 0) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                if (vapidKey === null || vapidKey.length !== UNCOMPRESSED_PUBLIC_KEY_SIZE) {\r\n                    throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n                }\r\n                details = {\r\n                    swScope: swScope,\r\n                    vapidKey: vapidKey\r\n                };\r\n                return [2 /*return*/, this.put(details)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes details of the current FCM VAPID key for a SW scope.\r\n     * Resolves once the scope/vapid details have been deleted and returns the\r\n     * deleted vapid key.\r\n     */\r\n    VapidDetailsModel.prototype.deleteVapidDetails = function (swScope) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var vapidKey;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getVapidFromSWScope(swScope)];\r\n                    case 1:\r\n                        vapidKey = _a.sent();\r\n                        if (!vapidKey) {\r\n                            throw errorFactory.create(\"delete-scope-not-found\" /* DELETE_SCOPE_NOT_FOUND */);\r\n                        }\r\n                        return [4 /*yield*/, this.delete(swScope)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, vapidKey];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return VapidDetailsModel;\r\n}(DbInterface));\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Token should be refreshed once a week.\r\nvar TOKEN_EXPIRATION_MILLIS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nvar BaseController = /** @class */ (function () {\r\n    function BaseController(app) {\r\n        var _this = this;\r\n        this.app = app;\r\n        this.vapidDetailsModel = new VapidDetailsModel();\r\n        this.subscriptionManager = new SubscriptionManager();\r\n        if (!app.options.messagingSenderId ||\r\n            typeof app.options.messagingSenderId !== 'string') {\r\n            throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n        }\r\n        this.INTERNAL = {\r\n            delete: function () { return _this.delete(); }\r\n        };\r\n        this.tokenDetailsModel = new TokenDetailsModel(app);\r\n    }\r\n    BaseController.prototype.getToken = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var currentPermission, swReg, publicVapidKey, pushSubscription, tokenDetails;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        currentPermission = this.getNotificationPermission_();\r\n                        if (currentPermission === 'denied') {\r\n                            throw errorFactory.create(\"notifications-blocked\" /* NOTIFICATIONS_BLOCKED */);\r\n                        }\r\n                        else if (currentPermission !== 'granted') {\r\n                            // We must wait for permission to be granted\r\n                            return [2 /*return*/, null];\r\n                        }\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        swReg = _a.sent();\r\n                        return [4 /*yield*/, this.getPublicVapidKey_()];\r\n                    case 2:\r\n                        publicVapidKey = _a.sent();\r\n                        return [4 /*yield*/, this.getPushSubscription(swReg, publicVapidKey)];\r\n                    case 3:\r\n                        pushSubscription = _a.sent();\r\n                        return [4 /*yield*/, this.tokenDetailsModel.getTokenDetailsFromSWScope(swReg.scope)];\r\n                    case 4:\r\n                        tokenDetails = _a.sent();\r\n                        if (tokenDetails) {\r\n                            return [2 /*return*/, this.manageExistingToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\r\n                        }\r\n                        return [2 /*return*/, this.getNewToken(swReg, pushSubscription, publicVapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * manageExistingToken is triggered if there's an existing FCM token in the\r\n     * database and it can take 3 different actions:\r\n     * 1) Retrieve the existing FCM token from the database.\r\n     * 2) If VAPID details have changed: Delete the existing token and create a\r\n     * new one with the new VAPID key.\r\n     * 3) If the database cache is invalidated: Send a request to FCM to update\r\n     * the token, and to check if the token is still valid on FCM-side.\r\n     */\r\n    BaseController.prototype.manageExistingToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var isTokenValid, now;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        isTokenValid = isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails);\r\n                        if (!isTokenValid) return [3 /*break*/, 1];\r\n                        now = Date.now();\r\n                        if (now < tokenDetails.createTime + TOKEN_EXPIRATION_MILLIS) {\r\n                            return [2 /*return*/, tokenDetails.fcmToken];\r\n                        }\r\n                        else {\r\n                            return [2 /*return*/, this.updateToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\r\n                        }\r\n                    case 1: \r\n                    // If the token is no longer valid (for example if the VAPID details\r\n                    // have changed), delete the existing token from the FCM client and server\r\n                    // database. No need to unsubscribe from the Service Worker as we have a\r\n                    // good push subscription that we'd like to use in getNewToken.\r\n                    return [4 /*yield*/, this.deleteTokenFromDB(tokenDetails.fcmToken)];\r\n                    case 2:\r\n                        // If the token is no longer valid (for example if the VAPID details\r\n                        // have changed), delete the existing token from the FCM client and server\r\n                        // database. No need to unsubscribe from the Service Worker as we have a\r\n                        // good push subscription that we'd like to use in getNewToken.\r\n                        _a.sent();\r\n                        return [2 /*return*/, this.getNewToken(swReg, pushSubscription, publicVapidKey)];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.updateToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var updatedToken, allDetails, e_1;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 6]);\r\n                        return [4 /*yield*/, this.subscriptionManager.updateToken(tokenDetails, this.app, pushSubscription, publicVapidKey)];\r\n                    case 1:\r\n                        updatedToken = _a.sent();\r\n                        allDetails = {\r\n                            swScope: swReg.scope,\r\n                            vapidKey: publicVapidKey,\r\n                            fcmSenderId: this.app.options.messagingSenderId,\r\n                            fcmToken: updatedToken,\r\n                            createTime: Date.now(),\r\n                            endpoint: pushSubscription.endpoint,\r\n                            auth: pushSubscription.getKey('auth'),\r\n                            p256dh: pushSubscription.getKey('p256dh')\r\n                        };\r\n                        return [4 /*yield*/, this.tokenDetailsModel.saveTokenDetails(allDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/, updatedToken];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        return [4 /*yield*/, this.deleteToken(tokenDetails.fcmToken)];\r\n                    case 5:\r\n                        _a.sent();\r\n                        throw e_1;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.getNewToken = function (swReg, pushSubscription, publicVapidKey) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var newToken, allDetails;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.subscriptionManager.getToken(this.app, pushSubscription, publicVapidKey)];\r\n                    case 1:\r\n                        newToken = _a.sent();\r\n                        allDetails = {\r\n                            swScope: swReg.scope,\r\n                            vapidKey: publicVapidKey,\r\n                            fcmSenderId: this.app.options.messagingSenderId,\r\n                            fcmToken: newToken,\r\n                            createTime: Date.now(),\r\n                            endpoint: pushSubscription.endpoint,\r\n                            auth: pushSubscription.getKey('auth'),\r\n                            p256dh: pushSubscription.getKey('p256dh')\r\n                        };\r\n                        return [4 /*yield*/, this.tokenDetailsModel.saveTokenDetails(allDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/, newToken];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes tokens that the token manager looks after,\r\n     * unsubscribes the token from FCM  and then unregisters the push\r\n     * subscription if it exists. It returns a promise that indicates\r\n     * whether or not the unsubscribe request was processed successfully.\r\n     */\r\n    BaseController.prototype.deleteToken = function (token) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var registration, pushSubscription;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: \r\n                    // Delete the token details from the database.\r\n                    return [4 /*yield*/, this.deleteTokenFromDB(token)];\r\n                    case 1:\r\n                        // Delete the token details from the database.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 2:\r\n                        registration = _a.sent();\r\n                        if (!registration) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, registration.pushManager.getSubscription()];\r\n                    case 3:\r\n                        pushSubscription = _a.sent();\r\n                        if (pushSubscription) {\r\n                            return [2 /*return*/, pushSubscription.unsubscribe()];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4: \r\n                    // If there's no SW, consider it a success.\r\n                    return [2 /*return*/, true];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method will delete the token from the client database, and make a\r\n     * call to FCM to remove it from the server DB. Does not temper with the\r\n     * push subscription.\r\n     */\r\n    BaseController.prototype.deleteTokenFromDB = function (token) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var tokenDetails;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.tokenDetailsModel.deleteToken(token)];\r\n                    case 1:\r\n                        tokenDetails = _a.sent();\r\n                        return [4 /*yield*/, this.subscriptionManager.deleteToken(this.app, tokenDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Gets a PushSubscription for the current user.\r\n     */\r\n    BaseController.prototype.getPushSubscription = function (swRegistration, publicVapidKey) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var subscription;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                    case 1:\r\n                        subscription = _a.sent();\r\n                        if (subscription) {\r\n                            return [2 /*return*/, subscription];\r\n                        }\r\n                        return [2 /*return*/, swRegistration.pushManager.subscribe({\r\n                                userVisibleOnly: true,\r\n                                applicationServerKey: publicVapidKey\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    //\r\n    // The following methods should only be available in the window.\r\n    //\r\n    /**\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    BaseController.prototype.requestPermission = function () {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.useServiceWorker = function (_registration) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.usePublicVapidKey = function (_b64PublicKey) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.onMessage = function (_nextOrObserver, _error, _completed) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.onTokenRefresh = function (_nextOrObserver, _error, _completed) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    //\r\n    // The following methods are used by the service worker only.\r\n    //\r\n    BaseController.prototype.setBackgroundMessageHandler = function (_callback) {\r\n        throw errorFactory.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    //\r\n    // The following methods are used by the service themselves and not exposed\r\n    // publicly or not expected to be used by developers.\r\n    //\r\n    /**\r\n     * This method is required to adhere to the Firebase interface.\r\n     * It closes any currently open indexdb database connections.\r\n     */\r\n    BaseController.prototype.delete = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, Promise.all([\r\n                            this.tokenDetailsModel.closeDatabase(),\r\n                            this.vapidDetailsModel.closeDatabase()\r\n                        ])];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Returns the current Notification Permission state.\r\n     */\r\n    BaseController.prototype.getNotificationPermission_ = function () {\r\n        return Notification.permission;\r\n    };\r\n    BaseController.prototype.getTokenDetailsModel = function () {\r\n        return this.tokenDetailsModel;\r\n    };\r\n    BaseController.prototype.getVapidDetailsModel = function () {\r\n        return this.vapidDetailsModel;\r\n    };\r\n    // Visible for testing\r\n    // TODO: make protected\r\n    BaseController.prototype.getSubscriptionManager = function () {\r\n        return this.subscriptionManager;\r\n    };\r\n    return BaseController;\r\n}());\r\n/**\r\n * Checks if the tokenDetails match the details provided in the clients.\r\n */\r\nfunction isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails) {\r\n    if (!tokenDetails.vapidKey ||\r\n        !isArrayBufferEqual(publicVapidKey.buffer, tokenDetails.vapidKey.buffer)) {\r\n        return false;\r\n    }\r\n    var isEndpointEqual = pushSubscription.endpoint === tokenDetails.endpoint;\r\n    var isAuthEqual = isArrayBufferEqual(pushSubscription.getKey('auth'), tokenDetails.auth);\r\n    var isP256dhEqual = isArrayBufferEqual(pushSubscription.getKey('p256dh'), tokenDetails.p256dh);\r\n    return isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FCM_MSG = 'FCM_MSG';\r\nvar SwController = /** @class */ (function (_super) {\r\n    Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__extends\"])(SwController, _super);\r\n    function SwController(app) {\r\n        var _this = _super.call(this, app) || this;\r\n        _this.bgMessageHandler = null;\r\n        self.addEventListener('push', function (e) {\r\n            _this.onPush(e);\r\n        });\r\n        self.addEventListener('pushsubscriptionchange', function (e) {\r\n            _this.onSubChange(e);\r\n        });\r\n        self.addEventListener('notificationclick', function (e) {\r\n            _this.onNotificationClick(e);\r\n        });\r\n        return _this;\r\n    }\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onPush = function (event) {\r\n        event.waitUntil(this.onPush_(event));\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onSubChange = function (event) {\r\n        event.waitUntil(this.onSubChange_(event));\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onNotificationClick = function (event) {\r\n        event.waitUntil(this.onNotificationClick_(event));\r\n    };\r\n    /**\r\n     * A handler for push events that shows notifications based on the content of\r\n     * the payload.\r\n     *\r\n     * The payload must be a JSON-encoded Object with a `notification` key. The\r\n     * value of the `notification` property will be used as the NotificationOptions\r\n     * object passed to showNotification. Additionally, the `title` property of the\r\n     * notification object will be used as the title.\r\n     *\r\n     * If there is no notification data in the payload then no notification will be\r\n     * shown.\r\n     */\r\n    SwController.prototype.onPush_ = function (event) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var msgPayload, hasVisibleClients, notificationDetails, notificationTitle, reg, actions, maxActions;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!event.data) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        try {\r\n                            msgPayload = event.data.json();\r\n                        }\r\n                        catch (err) {\r\n                            // Not JSON so not an FCM message\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, this.hasVisibleClients_()];\r\n                    case 1:\r\n                        hasVisibleClients = _a.sent();\r\n                        if (hasVisibleClients) {\r\n                            // App in foreground. Send to page.\r\n                            return [2 /*return*/, this.sendMessageToWindowClients_(msgPayload)];\r\n                        }\r\n                        notificationDetails = this.getNotificationData_(msgPayload);\r\n                        if (!notificationDetails) return [3 /*break*/, 3];\r\n                        notificationTitle = notificationDetails.title || '';\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 2:\r\n                        reg = _a.sent();\r\n                        actions = notificationDetails.actions;\r\n                        maxActions = Notification.maxActions;\r\n                        if (actions && maxActions && actions.length > maxActions) {\r\n                            console.warn(\"This browser only supports \" + maxActions + \" actions.\" +\r\n                                \"The remaining actions will not be displayed.\");\r\n                        }\r\n                        return [2 /*return*/, reg.showNotification(notificationTitle, notificationDetails)];\r\n                    case 3:\r\n                        if (!this.bgMessageHandler) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.bgMessageHandler(msgPayload)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onSubChange_ = function (_event) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var registration, err_1, err_2, tokenDetailsModel, tokenDetails;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        registration = _a.sent();\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        err_1 = _a.sent();\r\n                        throw errorFactory.create(\"unable-to-resubscribe\" /* UNABLE_TO_RESUBSCRIBE */, {\r\n                            errorInfo: err_1\r\n                        });\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 8]);\r\n                        return [4 /*yield*/, registration.pushManager.getSubscription()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 5:\r\n                        err_2 = _a.sent();\r\n                        tokenDetailsModel = this.getTokenDetailsModel();\r\n                        return [4 /*yield*/, tokenDetailsModel.getTokenDetailsFromSWScope(registration.scope)];\r\n                    case 6:\r\n                        tokenDetails = _a.sent();\r\n                        if (!tokenDetails) {\r\n                            // This should rarely occure, but could if indexedDB\r\n                            // is corrupted or wiped\r\n                            throw err_2;\r\n                        }\r\n                        // Attempt to delete the token if we know it's bad\r\n                        return [4 /*yield*/, this.deleteToken(tokenDetails.fcmToken)];\r\n                    case 7:\r\n                        // Attempt to delete the token if we know it's bad\r\n                        _a.sent();\r\n                        throw err_2;\r\n                    case 8: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onNotificationClick_ = function (event) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var msgPayload, link, windowClient, internalMsg;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!event.notification ||\r\n                            !event.notification.data ||\r\n                            !event.notification.data[FCM_MSG]) {\r\n                            // Not an FCM notification, do nothing.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (event.action) {\r\n                            // User clicked on an action button.\r\n                            // This will allow devs to act on action button clicks by using a custom\r\n                            // onNotificationClick listener that they define.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Prevent other listeners from receiving the event\r\n                        event.stopImmediatePropagation();\r\n                        event.notification.close();\r\n                        msgPayload = event.notification.data[FCM_MSG];\r\n                        if (!msgPayload.notification) {\r\n                            // Nothing to do.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        link = (msgPayload.fcmOptions && msgPayload.fcmOptions.link) ||\r\n                            msgPayload.notification.click_action;\r\n                        if (!link) {\r\n                            if (msgPayload.data && FN_CAMPAIGN_ID in msgPayload.data) {\r\n                                link = self.location.origin;\r\n                            }\r\n                            else {\r\n                                // Nothing to do.\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        return [4 /*yield*/, this.getWindowClient_(link)];\r\n                    case 1:\r\n                        windowClient = _a.sent();\r\n                        if (!!windowClient) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, self.clients.openWindow(link)];\r\n                    case 2:\r\n                        // Unable to find window client so need to open one.\r\n                        windowClient = _a.sent();\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        return [4 /*yield*/, sleep(3000)];\r\n                    case 3:\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 4: return [4 /*yield*/, windowClient.focus()];\r\n                    case 5:\r\n                        windowClient = _a.sent();\r\n                        _a.label = 6;\r\n                    case 6:\r\n                        if (!windowClient) {\r\n                            // Window Client will not be returned if it's for a third party origin.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Delete notification and fcmOptions data from payload before sending to\r\n                        // the page.\r\n                        delete msgPayload.notification;\r\n                        delete msgPayload.fcmOptions;\r\n                        internalMsg = createNewMsg(MessageType.NOTIFICATION_CLICKED, msgPayload);\r\n                        // Attempt to send a message to the client to handle the data\r\n                        // Is affected by: https://github.com/slightlyoff/ServiceWorker/issues/728\r\n                        return [2 /*return*/, this.attemptToMessageClient_(windowClient, internalMsg)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.getNotificationData_ = function (msgPayload) {\r\n        var _a;\r\n        if (!msgPayload) {\r\n            return;\r\n        }\r\n        if (typeof msgPayload.notification !== 'object') {\r\n            return;\r\n        }\r\n        var notificationInformation = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, msgPayload.notification);\r\n        // Put the message payload under FCM_MSG name so we can identify the\r\n        // notification as being an FCM notification vs a notification from\r\n        // somewhere else (i.e. normal web push or developer generated\r\n        // notification).\r\n        notificationInformation.data = Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])(Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__assign\"])({}, msgPayload.notification.data), (_a = {}, _a[FCM_MSG] = msgPayload, _a));\r\n        return notificationInformation;\r\n    };\r\n    /**\r\n     * Calling setBackgroundMessageHandler will opt in to some specific\r\n     * behaviours.\r\n     * 1.) If a notification doesn't need to be shown due to a window already\r\n     * being visible, then push messages will be sent to the page.\r\n     * 2.) If a notification needs to be shown, and the message contains no\r\n     * notification data this method will be called\r\n     * and the promise it returns will be passed to event.waitUntil.\r\n     * If you do not set this callback then all push messages will let and the\r\n     * developer can handle them in a their own 'push' event callback\r\n     *\r\n     * @param callback The callback to be called when a push message is received\r\n     * and a notification must be shown. The callback will be given the data from\r\n     * the push message.\r\n     */\r\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\r\n        if (!callback || typeof callback !== 'function') {\r\n            throw errorFactory.create(\"bg-handler-function-expected\" /* BG_HANDLER_FUNCTION_EXPECTED */);\r\n        }\r\n        this.bgMessageHandler = callback;\r\n    };\r\n    /**\r\n     * @param url The URL to look for when focusing a client.\r\n     * @return Returns an existing window client or a newly opened WindowClient.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.getWindowClient_ = function (url) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var parsedURL, clientList, suitableClient, i, parsedClientUrl;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        parsedURL = new URL(url, self.location.href).href;\r\n                        return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        suitableClient = null;\r\n                        for (i = 0; i < clientList.length; i++) {\r\n                            parsedClientUrl = new URL(clientList[i].url, self.location.href)\r\n                                .href;\r\n                            if (parsedClientUrl === parsedURL) {\r\n                                suitableClient = clientList[i];\r\n                                break;\r\n                            }\r\n                        }\r\n                        return [2 /*return*/, suitableClient];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This message will attempt to send the message to a window client.\r\n     * @param client The WindowClient to send the message to.\r\n     * @param message The message to send to the client.\r\n     * @returns Returns a promise that resolves after sending the message. This\r\n     * does not guarantee that the message was successfully received.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.attemptToMessageClient_ = function (client, message) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                // NOTE: This returns a promise in case this API is abstracted later on to\r\n                // do additional work\r\n                if (!client) {\r\n                    throw errorFactory.create(\"no-window-client-to-msg\" /* NO_WINDOW_CLIENT_TO_MSG */);\r\n                }\r\n                client.postMessage(message);\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @returns If there is currently a visible WindowClient, this method will\r\n     * resolve to true, otherwise false.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.hasVisibleClients_ = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var clientList;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        return [2 /*return*/, clientList.some(function (client) {\r\n                                return client.visibilityState === 'visible' &&\r\n                                    // Ignore chrome-extension clients as that matches the background pages\r\n                                    // of extensions, which are always considered visible.\r\n                                    !client.url.startsWith('chrome-extension://');\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param msgPayload The data from the push event that should be sent to all\r\n     * available pages.\r\n     * @returns Returns a promise that resolves once the message has been sent to\r\n     * all WindowClients.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.sendMessageToWindowClients_ = function (msgPayload) {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var clientList, internalMsg;\r\n            var _this = this;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        internalMsg = createNewMsg(MessageType.PUSH_MSG_RECEIVED, msgPayload);\r\n                        return [4 /*yield*/, Promise.all(clientList.map(function (client) {\r\n                                return _this.attemptToMessageClient_(client, internalMsg);\r\n                            }))];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will register the default service worker and return the registration.\r\n     * @return he service worker registration to be used for the push service.\r\n     */\r\n    SwController.prototype.getSWRegistration_ = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                return [2 /*return*/, self.registration];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will return the default VAPID key or the uint8array version of the\r\n     * public VAPID key provided by the developer.\r\n     */\r\n    SwController.prototype.getPublicVapidKey_ = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var swReg, vapidKeyFromDatabase;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        swReg = _a.sent();\r\n                        if (!swReg) {\r\n                            throw errorFactory.create(\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */);\r\n                        }\r\n                        return [4 /*yield*/, this.getVapidDetailsModel().getVapidFromSWScope(swReg.scope)];\r\n                    case 2:\r\n                        vapidKeyFromDatabase = _a.sent();\r\n                        if (vapidKeyFromDatabase == null) {\r\n                            return [2 /*return*/, DEFAULT_PUBLIC_VAPID_KEY];\r\n                        }\r\n                        return [2 /*return*/, vapidKeyFromDatabase];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SwController;\r\n}(BaseController));\r\nfunction getClientList() {\r\n    return self.clients.matchAll({\r\n        type: 'window',\r\n        includeUncontrolled: true\r\n        // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\r\n    });\r\n}\r\nfunction createNewMsg(msgType, msgData) {\r\n    return {\r\n        firebaseMessagingType: msgType,\r\n        firebaseMessagingData: msgData\r\n    };\r\n}\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WindowController = /** @class */ (function (_super) {\r\n    Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__extends\"])(WindowController, _super);\r\n    /**\r\n     * A service that provides a MessagingService instance.\r\n     */\r\n    function WindowController(app) {\r\n        var _this = _super.call(this, app) || this;\r\n        _this.registrationToUse = null;\r\n        _this.publicVapidKeyToUse = null;\r\n        _this.messageObserver = null;\r\n        // @ts-ignore: Unused variable error, this is not implemented yet.\r\n        _this.tokenRefreshObserver = null;\r\n        _this.onMessageInternal = Object(_firebase_util__WEBPACK_IMPORTED_MODULE_2__[\"createSubscribe\"])(function (observer) {\r\n            _this.messageObserver = observer;\r\n        });\r\n        _this.onTokenRefreshInternal = Object(_firebase_util__WEBPACK_IMPORTED_MODULE_2__[\"createSubscribe\"])(function (observer) {\r\n            _this.tokenRefreshObserver = observer;\r\n        });\r\n        _this.setupSWMessageListener_();\r\n        return _this;\r\n    }\r\n    /**\r\n     * Request permission if it is not currently granted\r\n     *\r\n     * @return Resolves if the permission was granted, otherwise rejects\r\n     *\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    WindowController.prototype.requestPermission = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            var permissionResult;\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.getNotificationPermission_() === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        permissionResult = _a.sent();\r\n                        if (permissionResult === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (permissionResult === 'denied') {\r\n                            throw errorFactory.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        else {\r\n                            throw errorFactory.create(\"permission-default\" /* PERMISSION_DEFAULT */);\r\n                        }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method allows a developer to override the default service worker and\r\n     * instead use a custom service worker.\r\n     *\r\n     * @param registration The service worker registration that should be used to\r\n     * receive the push messages.\r\n     */\r\n    WindowController.prototype.useServiceWorker = function (registration) {\r\n        if (!(registration instanceof ServiceWorkerRegistration)) {\r\n            throw errorFactory.create(\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */);\r\n        }\r\n        if (this.registrationToUse != null) {\r\n            throw errorFactory.create(\"use-sw-before-get-token\" /* USE_SW_BEFORE_GET_TOKEN */);\r\n        }\r\n        this.registrationToUse = registration;\r\n    };\r\n    /**\r\n     * This method allows a developer to override the default vapid key\r\n     * and instead use a custom VAPID public key.\r\n     *\r\n     * @param publicKey A URL safe base64 encoded string.\r\n     */\r\n    WindowController.prototype.usePublicVapidKey = function (publicKey) {\r\n        if (typeof publicKey !== 'string') {\r\n            throw errorFactory.create(\"invalid-public-vapid-key\" /* INVALID_PUBLIC_VAPID_KEY */);\r\n        }\r\n        if (this.publicVapidKeyToUse != null) {\r\n            throw errorFactory.create(\"use-public-key-before-get-token\" /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */);\r\n        }\r\n        var parsedKey = base64ToArrayBuffer(publicKey);\r\n        if (parsedKey.length !== 65) {\r\n            throw errorFactory.create(\"public-vapid-key-decryption-failed\" /* PUBLIC_KEY_DECRYPTION_FAILED */);\r\n        }\r\n        this.publicVapidKeyToUse = parsedKey;\r\n    };\r\n    /**\r\n     * @export\r\n     * @param nextOrObserver An observer object or a function triggered on\r\n     * message.\r\n     * @param error A function triggered on message error.\r\n     * @param completed function triggered when the observer is removed.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onMessage = function (nextOrObserver, error, completed) {\r\n        if (typeof nextOrObserver === 'function') {\r\n            return this.onMessageInternal(nextOrObserver, error, completed);\r\n        }\r\n        else {\r\n            return this.onMessageInternal(nextOrObserver);\r\n        }\r\n    };\r\n    /**\r\n     * @param nextOrObserver An observer object or a function triggered on token\r\n     * refresh.\r\n     * @param error A function triggered on token refresh error.\r\n     * @param completed function triggered when the observer is removed.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onTokenRefresh = function (nextOrObserver, error, completed) {\r\n        if (typeof nextOrObserver === 'function') {\r\n            return this.onTokenRefreshInternal(nextOrObserver, error, completed);\r\n        }\r\n        else {\r\n            return this.onTokenRefreshInternal(nextOrObserver);\r\n        }\r\n    };\r\n    /**\r\n     * Given a registration, wait for the service worker it relates to\r\n     * become activer\r\n     * @param registration Registration to wait for service worker to become active\r\n     * @return Wait for service worker registration to become active\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    WindowController.prototype.waitForRegistrationToActivate_ = function (registration) {\r\n        var serviceWorker = registration.installing || registration.waiting || registration.active;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!serviceWorker) {\r\n                // This is a rare scenario but has occured in firefox\r\n                reject(errorFactory.create(\"no-sw-in-reg\" /* NO_SW_IN_REG */));\r\n                return;\r\n            }\r\n            // Because the Promise function is called on next tick there is a\r\n            // small chance that the worker became active or redundant already.\r\n            if (serviceWorker.state === 'activated') {\r\n                resolve(registration);\r\n                return;\r\n            }\r\n            if (serviceWorker.state === 'redundant') {\r\n                reject(errorFactory.create(\"sw-reg-redundant\" /* SW_REG_REDUNDANT */));\r\n                return;\r\n            }\r\n            var stateChangeListener = function () {\r\n                if (serviceWorker.state === 'activated') {\r\n                    resolve(registration);\r\n                }\r\n                else if (serviceWorker.state === 'redundant') {\r\n                    reject(errorFactory.create(\"sw-reg-redundant\" /* SW_REG_REDUNDANT */));\r\n                }\r\n                else {\r\n                    // Return early and wait to next state change\r\n                    return;\r\n                }\r\n                serviceWorker.removeEventListener('statechange', stateChangeListener);\r\n            };\r\n            serviceWorker.addEventListener('statechange', stateChangeListener);\r\n        });\r\n    };\r\n    /**\r\n     * This will register the default service worker and return the registration\r\n     * @return The service worker registration to be used for the push service.\r\n     */\r\n    WindowController.prototype.getSWRegistration_ = function () {\r\n        var _this = this;\r\n        if (this.registrationToUse) {\r\n            return this.waitForRegistrationToActivate_(this.registrationToUse);\r\n        }\r\n        // Make the registration null so we know useServiceWorker will not\r\n        // use a new service worker as registrationToUse is no longer undefined\r\n        this.registrationToUse = null;\r\n        return navigator.serviceWorker\r\n            .register(DEFAULT_SW_PATH, {\r\n            scope: DEFAULT_SW_SCOPE\r\n        })\r\n            .catch(function (err) {\r\n            throw errorFactory.create(\"failed-serviceworker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n                browserErrorMessage: err.message\r\n            });\r\n        })\r\n            .then(function (registration) {\r\n            return _this.waitForRegistrationToActivate_(registration).then(function () {\r\n                _this.registrationToUse = registration;\r\n                // We update after activation due to an issue with Firefox v49 where\r\n                // a race condition occassionally causes the service worker to not\r\n                // install\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                registration.update();\r\n                return registration;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will return the default VAPID key or the uint8array version of the\r\n     * public VAPID key provided by the developer.\r\n     */\r\n    WindowController.prototype.getPublicVapidKey_ = function () {\r\n        return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__awaiter\"])(this, void 0, void 0, function () {\r\n            return Object(tslib__WEBPACK_IMPORTED_MODULE_1__[\"__generator\"])(this, function (_a) {\r\n                if (this.publicVapidKeyToUse) {\r\n                    return [2 /*return*/, this.publicVapidKeyToUse];\r\n                }\r\n                return [2 /*return*/, DEFAULT_PUBLIC_VAPID_KEY];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method will set up a message listener to handle\r\n     * events from the service worker that should trigger\r\n     * events in the page.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    WindowController.prototype.setupSWMessageListener_ = function () {\r\n        var _this = this;\r\n        navigator.serviceWorker.addEventListener('message', function (event) {\r\n            if (!event.data ||\r\n                !event.data.firebaseMessagingType ||\r\n                !event.data.firebaseMessagingData) {\r\n                // Not a message from FCM\r\n                return;\r\n            }\r\n            var _a = event.data, firebaseMessagingType = _a.firebaseMessagingType, firebaseMessagingData = _a.firebaseMessagingData;\r\n            if (_this.messageObserver) {\r\n                _this.messageObserver.next(firebaseMessagingData);\r\n            }\r\n            var data = firebaseMessagingData.data;\r\n            if (data &&\r\n                FN_CAMPAIGN_ID in data &&\r\n                data[FN_CAMPAIGN_ANALYTICS_ENABLED] === '1') {\r\n                // This message has a campaign id, meaning it was sent using the FN Console.\r\n                // Analytics is enabled on this message, so we should log it.\r\n                var eventType = getEventType(firebaseMessagingType);\r\n                _this.app.INTERNAL.analytics.logEvent(eventType, \r\n                /* eslint-disable camelcase */\r\n                {\r\n                    message_name: data[FN_CAMPAIGN_NAME],\r\n                    message_id: data[FN_CAMPAIGN_ID],\r\n                    message_time: data[FN_CAMPAIGN_TIME],\r\n                    message_device_time: Math.floor(Date.now() / 1000)\r\n                }\r\n                /* eslint-enable camelcase */\r\n                );\r\n            }\r\n        }, false);\r\n    };\r\n    return WindowController;\r\n}(BaseController));\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_MSG_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerMessaging(instance) {\r\n    var messagingName = 'messaging';\r\n    var factoryMethod = function (app) {\r\n        if (!isSupported()) {\r\n            throw errorFactory.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n        }\r\n        if (self && 'ServiceWorkerGlobalScope' in self) {\r\n            // Running in ServiceWorker context\r\n            return new SwController(app);\r\n        }\r\n        else {\r\n            // Assume we are in the window context.\r\n            return new WindowController(app);\r\n        }\r\n    };\r\n    var namespaceExports = {\r\n        isSupported: isSupported\r\n    };\r\n    instance.INTERNAL.registerService(messagingName, factoryMethod, namespaceExports);\r\n}\r\nregisterMessaging(_firebase_app__WEBPACK_IMPORTED_MODULE_0___default.a);\r\nfunction isSupported() {\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return isSWControllerSupported();\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return isWindowControllerSupported();\r\n    }\r\n}\r\n/**\r\n * Checks to see if the required APIs exist.\r\n */\r\nfunction isWindowControllerSupported() {\r\n    return (navigator.cookieEnabled &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\r\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\r\nfunction isSWControllerSupported() {\r\n    return ('PushManager' in self &&\r\n        'Notification' in self &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n\n\n//# sourceMappingURL=index.esm.js.map\n\n\n/***/ }),\n\n/***/ \"./node_modules/firebase/messaging/dist/index.esm.js\":\n/*!***********************************************************!*\\\n  !*** ./node_modules/firebase/messaging/dist/index.esm.js ***!\n  \\***********************************************************/\n/*! no exports provided */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _firebase_messaging__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @firebase/messaging */ \"./node_modules/@firebase/messaging/dist/index.esm.js\");\n\n//# sourceMappingURL=index.esm.js.map\n\n\n/***/ }),\n\n/***/ \"./node_modules/idb/build/idb.js\":\n/*!***************************************!*\\\n  !*** ./node_modules/idb/build/idb.js ***!\n  \\***************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n(function (global, factory) {\n   true ? factory(exports) :\n  undefined;\n}(this, function (exports) { 'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function(db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n\n\n/***/ })\n\n}]);\n//# sourceMappingURL=firebase-messaging-es2015.js.map","import firebase from '@firebase/app';\nimport { __values, __awaiter, __generator, __spread, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar version = \"0.3.6\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallation(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallation(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthToken(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _a.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _a.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(appConfig, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(appConfig, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(appConfig, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n */\r\nfunction waitUntilAuthTokenRequest(appConfig, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(appConfig, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthToken(appConfig, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(appConfig).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(app, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, completeInstallationRegistration(appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(appConfig, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation$1(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallation(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    var factoryMethod = function (app) {\r\n        // Throws if app isn't configured properly.\r\n        extractAppConfig(app);\r\n        return {\r\n            app: app,\r\n            getId: function () { return getId(app); },\r\n            getToken: function (forceRefresh) { return getToken(app, forceRefresh); },\r\n            delete: function () { return deleteInstallation$1(app); }\r\n        };\r\n    };\r\n    instance.INTERNAL.registerService(installationsName, factoryMethod);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","import firebase from '@firebase/app';\nimport { __spread, __awaiter, __generator, __extends, __assign } from 'tslib';\nimport { ErrorFactory, createSubscribe } from '@firebase/util';\nimport '@firebase/installations';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_MAP = (_a = {},\r\n    _a[\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\r\n    _a[\"only-available-in-sw\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\r\n    _a[\"should-be-overriden\" /* SHOULD_BE_INHERITED */] = 'This method should be overriden by extended classes.',\r\n    _a[\"bad-sender-id\" /* BAD_SENDER_ID */] = \"Please ensure that 'messagingSenderId' is set \" +\r\n        'correctly in the options passed into firebase.initializeApp().',\r\n    _a[\"permission-default\" /* PERMISSION_DEFAULT */] = 'The required permissions were not granted and dismissed instead.',\r\n    _a[\"permission-blocked\" /* PERMISSION_BLOCKED */] = 'The required permissions were not granted and blocked instead.',\r\n    _a[\"unsupported-browser\" /* UNSUPPORTED_BROWSER */] = \"This browser doesn't support the API's \" +\r\n        'required to use the firebase SDK.',\r\n    _a[\"notifications-blocked\" /* NOTIFICATIONS_BLOCKED */] = 'Notifications have been blocked.',\r\n    _a[\"failed-serviceworker-registration\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the ' +\r\n        'default service worker. {$browserErrorMessage}',\r\n    _a[\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */] = 'A service worker registration was the expected input.',\r\n    _a[\"get-subscription-failed\" /* GET_SUBSCRIPTION_FAILED */] = 'There was an error when trying to get ' +\r\n        'any existing Push Subscriptions.',\r\n    _a[\"invalid-saved-token\" /* INVALID_SAVED_TOKEN */] = 'Unable to access details of the saved token.',\r\n    _a[\"sw-reg-redundant\" /* SW_REG_REDUNDANT */] = 'The service worker being used for push was made redundant.',\r\n    _a[\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occured while subscribing the user to FCM: {$errorInfo}',\r\n    _a[\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\r\n    _a[\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occured while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    _a[\"token-update-failed\" /* TOKEN_UPDATE_FAILED */] = 'A problem occured while updating the user from FCM: {$errorInfo}',\r\n    _a[\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\r\n    _a[\"use-sw-before-get-token\" /* USE_SW_BEFORE_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    _a[\"invalid-delete-token\" /* INVALID_DELETE_TOKEN */] = 'You must pass a valid token into ' +\r\n        'deleteToken(), i.e. the token from getToken().',\r\n    _a[\"delete-token-not-found\" /* DELETE_TOKEN_NOT_FOUND */] = 'The deletion attempt for token could not ' +\r\n        'be performed as the token was not found.',\r\n    _a[\"delete-scope-not-found\" /* DELETE_SCOPE_NOT_FOUND */] = 'The deletion attempt for service worker ' +\r\n        'scope could not be performed as the scope was not found.',\r\n    _a[\"bg-handler-function-expected\" /* BG_HANDLER_FUNCTION_EXPECTED */] = 'The input to setBackgroundMessageHandler() must be a function.',\r\n    _a[\"no-window-client-to-msg\" /* NO_WINDOW_CLIENT_TO_MSG */] = 'An attempt was made to message a non-existant window client.',\r\n    _a[\"unable-to-resubscribe\" /* UNABLE_TO_RESUBSCRIBE */] = 'There was an error while re-subscribing ' +\r\n        'the FCM token for push messaging. Will have to resubscribe the ' +\r\n        'user on next visit. {$errorInfo}',\r\n    _a[\"no-fcm-token-for-resubscribe\" /* NO_FCM_TOKEN_FOR_RESUBSCRIBE */] = 'Could not find an FCM token ' +\r\n        'and as a result, unable to resubscribe. Will have to resubscribe the ' +\r\n        'user on next visit.',\r\n    _a[\"failed-to-delete-token\" /* FAILED_TO_DELETE_TOKEN */] = 'Unable to delete the currently saved token.',\r\n    _a[\"no-sw-in-reg\" /* NO_SW_IN_REG */] = 'Even though the service worker registration was ' +\r\n        'successful, there was a problem accessing the service worker itself.',\r\n    _a[\"bad-scope\" /* BAD_SCOPE */] = 'The service worker scope must be a string with at ' +\r\n        'least one character.',\r\n    _a[\"bad-vapid-key\" /* BAD_VAPID_KEY */] = 'The public VAPID key is not a Uint8Array with 65 bytes.',\r\n    _a[\"bad-subscription\" /* BAD_SUBSCRIPTION */] = 'The subscription must be a valid PushSubscription.',\r\n    _a[\"bad-token\" /* BAD_TOKEN */] = 'The FCM Token used for storage / lookup was not ' +\r\n        'a valid token string.',\r\n    _a[\"failed-delete-vapid-key\" /* FAILED_DELETE_VAPID_KEY */] = 'The VAPID key could not be deleted.',\r\n    _a[\"invalid-public-vapid-key\" /* INVALID_PUBLIC_VAPID_KEY */] = 'The public VAPID key must be a string.',\r\n    _a[\"use-public-key-before-get-token\" /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.',\r\n    _a[\"public-vapid-key-decryption-failed\" /* PUBLIC_KEY_DECRYPTION_FAILED */] = 'The public VAPID key did not equal 65 bytes when decrypted.',\r\n    _a);\r\nvar errorFactory = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_PUBLIC_VAPID_KEY = new Uint8Array([\r\n    0x04,\r\n    0x33,\r\n    0x94,\r\n    0xf7,\r\n    0xdf,\r\n    0xa1,\r\n    0xeb,\r\n    0xb1,\r\n    0xdc,\r\n    0x03,\r\n    0xa2,\r\n    0x5e,\r\n    0x15,\r\n    0x71,\r\n    0xdb,\r\n    0x48,\r\n    0xd3,\r\n    0x2e,\r\n    0xed,\r\n    0xed,\r\n    0xb2,\r\n    0x34,\r\n    0xdb,\r\n    0xb7,\r\n    0x47,\r\n    0x3a,\r\n    0x0c,\r\n    0x8f,\r\n    0xc4,\r\n    0xcc,\r\n    0xe1,\r\n    0x6f,\r\n    0x3c,\r\n    0x8c,\r\n    0x84,\r\n    0xdf,\r\n    0xab,\r\n    0xb6,\r\n    0x66,\r\n    0x3e,\r\n    0xf2,\r\n    0x0c,\r\n    0xd4,\r\n    0x8b,\r\n    0xfe,\r\n    0xe3,\r\n    0xf9,\r\n    0x76,\r\n    0x2f,\r\n    0x14,\r\n    0x1c,\r\n    0x63,\r\n    0x08,\r\n    0x6a,\r\n    0x6f,\r\n    0x2d,\r\n    0xb1,\r\n    0x1a,\r\n    0x95,\r\n    0xb0,\r\n    0xce,\r\n    0x37,\r\n    0xc0,\r\n    0x9c,\r\n    0x6e\r\n]);\r\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\nvar FN_CAMPAIGN_ID = 'google.c.a.c_id';\r\nvar FN_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nvar FN_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nvar FN_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_MSG_RECEIVED\"] = \"push-msg-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isArrayBufferEqual(a, b) {\r\n    if (a == null || b == null) {\r\n        return false;\r\n    }\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a.byteLength !== b.byteLength) {\r\n        return false;\r\n    }\r\n    var viewA = new DataView(a);\r\n    var viewB = new DataView(b);\r\n    for (var i = 0; i < a.byteLength; i++) {\r\n        if (viewA.getUint8(i) !== viewB.getUint8(i)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction toBase64(arrayBuffer) {\r\n    var uint8Version = new Uint8Array(arrayBuffer);\r\n    return btoa(String.fromCharCode.apply(String, __spread(uint8Version)));\r\n}\r\nfunction arrayBufferToBase64(arrayBuffer) {\r\n    var base64String = toBase64(arrayBuffer);\r\n    return base64String\r\n        .replace(/=/g, '')\r\n        .replace(/\\+/g, '-')\r\n        .replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SubscriptionManager = /** @class */ (function () {\r\n    function SubscriptionManager() {\r\n    }\r\n    SubscriptionManager.prototype.getToken = function (app, subscription, vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, body, subscribeOptions, responseData, response, err_1, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(app)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        body = getBody(subscription, vapidKey);\r\n                        subscribeOptions = {\r\n                            method: 'POST',\r\n                            headers: headers,\r\n                            body: JSON.stringify(body)\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(app), subscribeOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_1 = _a.sent();\r\n                        throw errorFactory.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                            errorInfo: err_1\r\n                        });\r\n                    case 6:\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        if (!responseData.token) {\r\n                            throw errorFactory.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n                        }\r\n                        return [2 /*return*/, responseData.token];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Update the underlying token details for fcmToken.\r\n     */\r\n    SubscriptionManager.prototype.updateToken = function (tokenDetails, app, subscription, vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, body, updateOptions, responseData, response, err_2, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(app)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        body = getBody(subscription, vapidKey);\r\n                        updateOptions = {\r\n                            method: 'PATCH',\r\n                            headers: headers,\r\n                            body: JSON.stringify(body)\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(app) + \"/\" + tokenDetails.fcmToken, updateOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_2 = _a.sent();\r\n                        throw errorFactory.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                            errorInfo: err_2\r\n                        });\r\n                    case 6:\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        if (!responseData.token) {\r\n                            throw errorFactory.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n                        }\r\n                        return [2 /*return*/, responseData.token];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SubscriptionManager.prototype.deleteToken = function (app, tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, unsubscribeOptions, response, responseData, message, err_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(app)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        unsubscribeOptions = {\r\n                            method: 'DELETE',\r\n                            headers: headers\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(app) + \"/\" + tokenDetails.fcmToken, unsubscribeOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_3 = _a.sent();\r\n                        throw errorFactory.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                            errorInfo: err_3\r\n                        });\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SubscriptionManager;\r\n}());\r\nfunction getEndpoint(app) {\r\n    return ENDPOINT + \"/projects/\" + app.options.projectId + \"/registrations\";\r\n}\r\nfunction getHeaders(app) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var installations, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    installations = app.installations();\r\n                    return [4 /*yield*/, installations.getToken()];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, new Headers({\r\n                            'Content-Type': 'application/json',\r\n                            Accept: 'application/json',\r\n                            'x-goog-api-key': app.options.apiKey,\r\n                            'x-goog-firebase-installations-auth': \"FIS \" + authToken\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getBody(subscription, vapidKey) {\r\n    var p256dh = arrayBufferToBase64(subscription.getKey('p256dh'));\r\n    var auth = arrayBufferToBase64(subscription.getKey('auth'));\r\n    var body = {\r\n        web: {\r\n            endpoint: subscription.endpoint,\r\n            p256dh: p256dh,\r\n            auth: auth\r\n        }\r\n    };\r\n    if (!isArrayBufferEqual(vapidKey.buffer, DEFAULT_PUBLIC_VAPID_KEY.buffer)) {\r\n        body.web.applicationPubKey = arrayBufferToBase64(vapidKey);\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction base64ToArrayBuffer(base64String) {\r\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    var rawData = atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar OLD_DB_NAME = 'undefined';\r\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nfunction handleDb(db, app) {\r\n    if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n        // We found a database with the name 'undefined', but our expected object\r\n        // store isn't defined.\r\n        return;\r\n    }\r\n    var transaction = db.transaction(OLD_OBJECT_STORE_NAME);\r\n    var objectStore = transaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n    var subscriptionManager = new SubscriptionManager();\r\n    var openCursorRequest = objectStore.openCursor();\r\n    openCursorRequest.onerror = function (event) {\r\n        // NOOP - Nothing we can do.\r\n        console.warn('Unable to cleanup old IDB.', event);\r\n    };\r\n    openCursorRequest.onsuccess = function () {\r\n        var cursor = openCursorRequest.result;\r\n        if (cursor) {\r\n            // cursor.value contains the current record being iterated through\r\n            // this is where you'd do something with the result\r\n            var tokenDetails = cursor.value;\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            subscriptionManager.deleteToken(app, tokenDetails);\r\n            cursor.continue();\r\n        }\r\n        else {\r\n            db.close();\r\n            indexedDB.deleteDatabase(OLD_DB_NAME);\r\n        }\r\n    };\r\n}\r\nfunction cleanV1(app) {\r\n    var request = indexedDB.open(OLD_DB_NAME);\r\n    request.onerror = function (_event) {\r\n        // NOOP - Nothing we can do.\r\n    };\r\n    request.onsuccess = function (_event) {\r\n        var db = request.result;\r\n        handleDb(db, app);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DbInterface = /** @class */ (function () {\r\n    function DbInterface() {\r\n        this.dbPromise = null;\r\n    }\r\n    /** Gets record(s) from the objectStore that match the given key. */\r\n    DbInterface.prototype.get = function (key) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.get(key); });\r\n    };\r\n    /** Gets record(s) from the objectStore that match the given index. */\r\n    DbInterface.prototype.getIndex = function (index, key) {\r\n        function runRequest(objectStore) {\r\n            var idbIndex = objectStore.index(index);\r\n            return idbIndex.get(key);\r\n        }\r\n        return this.createTransaction(runRequest);\r\n    };\r\n    /** Assigns or overwrites the record for the given value. */\r\n    // IndexedDB values are of type \"any\"\r\n    DbInterface.prototype.put = function (value) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.put(value); }, 'readwrite');\r\n    };\r\n    /** Deletes record(s) from the objectStore that match the given key. */\r\n    DbInterface.prototype.delete = function (key) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.delete(key); }, 'readwrite');\r\n    };\r\n    /**\r\n     * Close the currently open database.\r\n     */\r\n    DbInterface.prototype.closeDatabase = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var db;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.dbPromise) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.dbPromise];\r\n                    case 1:\r\n                        db = _a.sent();\r\n                        db.close();\r\n                        this.dbPromise = null;\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Creates an IndexedDB Transaction and passes its objectStore to the\r\n     * runRequest function, which runs the database request.\r\n     *\r\n     * @return Promise that resolves with the result of the runRequest function\r\n     */\r\n    DbInterface.prototype.createTransaction = function (runRequest, mode) {\r\n        if (mode === void 0) { mode = 'readonly'; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var db, transaction, request, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getDb()];\r\n                    case 1:\r\n                        db = _a.sent();\r\n                        transaction = db.transaction(this.objectStoreName, mode);\r\n                        request = transaction.objectStore(this.objectStoreName);\r\n                        return [4 /*yield*/, promisify(runRequest(request))];\r\n                    case 2:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                                transaction.oncomplete = function () {\r\n                                    resolve(result);\r\n                                };\r\n                                transaction.onerror = function () {\r\n                                    reject(transaction.error);\r\n                                };\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Gets the cached db connection or opens a new one. */\r\n    DbInterface.prototype.getDb = function () {\r\n        var _this = this;\r\n        if (!this.dbPromise) {\r\n            this.dbPromise = new Promise(function (resolve, reject) {\r\n                var request = indexedDB.open(_this.dbName, _this.dbVersion);\r\n                request.onsuccess = function () {\r\n                    resolve(request.result);\r\n                };\r\n                request.onerror = function () {\r\n                    _this.dbPromise = null;\r\n                    reject(request.error);\r\n                };\r\n                request.onupgradeneeded = function (event) { return _this.onDbUpgrade(request, event); };\r\n            });\r\n        }\r\n        return this.dbPromise;\r\n    };\r\n    return DbInterface;\r\n}());\r\n/** Promisifies an IDBRequest. Resolves with the IDBRequest's result. */\r\nfunction promisify(request) {\r\n    return new Promise(function (resolve, reject) {\r\n        request.onsuccess = function () {\r\n            resolve(request.result);\r\n        };\r\n        request.onerror = function () {\r\n            reject(request.error);\r\n        };\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TokenDetailsModel = /** @class */ (function (_super) {\r\n    __extends(TokenDetailsModel, _super);\r\n    function TokenDetailsModel(app) {\r\n        var _this = _super.call(this) || this;\r\n        _this.app = app;\r\n        _this.dbName = 'fcm_token_details_db';\r\n        _this.dbVersion = 4;\r\n        _this.objectStoreName = 'fcm_token_object_Store';\r\n        return _this;\r\n    }\r\n    TokenDetailsModel.prototype.onDbUpgrade = function (request, event) {\r\n        var db = request.result;\r\n        // Lack of 'break' statements is intentional.\r\n        switch (event.oldVersion) {\r\n            case 0: {\r\n                // New IDB instance\r\n                var objectStore = db.createObjectStore(this.objectStoreName, {\r\n                    keyPath: 'swScope'\r\n                });\r\n                // Make sure the sender ID can be searched\r\n                objectStore.createIndex('fcmSenderId', 'fcmSenderId', {\r\n                    unique: false\r\n                });\r\n                objectStore.createIndex('fcmToken', 'fcmToken', { unique: true });\r\n            }\r\n            case 1: {\r\n                // Prior to version 2, we were using either 'fcm_token_details_db'\r\n                // or 'undefined' as the database name due to bug in the SDK\r\n                // So remove the old tokens and databases.\r\n                cleanV1(this.app);\r\n            }\r\n            case 2: {\r\n                // Update from v2 to v4 directly in a single openCursor request.\r\n                // We need to do this because for some reason, doing a subsequent update on the same data\r\n                // in the same transaction drops the first update.\r\n                var objectStore = request.transaction.objectStore(this.objectStoreName);\r\n                var cursorRequest_1 = objectStore.openCursor();\r\n                cursorRequest_1.onsuccess = function () {\r\n                    var cursor = cursorRequest_1.result;\r\n                    if (cursor) {\r\n                        var value = cursor.value;\r\n                        var newValue = __assign({}, value);\r\n                        if (!value.createTime) {\r\n                            newValue.createTime = Date.now();\r\n                        }\r\n                        if (typeof value.vapidKey === 'string') {\r\n                            newValue.vapidKey = base64ToArrayBuffer(value.vapidKey);\r\n                        }\r\n                        if (typeof value.auth === 'string') {\r\n                            newValue.auth = base64ToArrayBuffer(value.auth).buffer;\r\n                        }\r\n                        if (typeof value.auth === 'string') {\r\n                            newValue.p256dh = base64ToArrayBuffer(value.p256dh).buffer;\r\n                        }\r\n                        if (typeof value.fcmPushSet === 'string') {\r\n                            delete newValue.fcmPushSet;\r\n                        }\r\n                        cursor.update(newValue);\r\n                        cursor.continue();\r\n                    }\r\n                };\r\n                // Break here as we've already updated to v4.\r\n                break;\r\n            }\r\n            case 3: {\r\n                // Update from V3 to V4.\r\n                var objectStore = request.transaction.objectStore(this.objectStoreName);\r\n                var cursorRequest_2 = objectStore.openCursor();\r\n                cursorRequest_2.onsuccess = function () {\r\n                    var cursor = cursorRequest_2.result;\r\n                    if (cursor) {\r\n                        var value = cursor.value;\r\n                        var newValue = __assign({}, value);\r\n                        if (typeof value.fcmPushSet === 'string') {\r\n                            delete newValue.fcmPushSet;\r\n                        }\r\n                        cursor.update(newValue);\r\n                        cursor.continue();\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Given a token, this method will look up the details in indexedDB.\r\n     */\r\n    TokenDetailsModel.prototype.getTokenDetailsFromToken = function (fcmToken) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!fcmToken) {\r\n                    throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n                }\r\n                validateInputs({ fcmToken: fcmToken });\r\n                return [2 /*return*/, this.getIndex('fcmToken', fcmToken)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Given a service worker scope, this method will look up the details in\r\n     * indexedDB.\r\n     * @return The details associated with that token.\r\n     */\r\n    TokenDetailsModel.prototype.getTokenDetailsFromSWScope = function (swScope) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!swScope) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                validateInputs({ swScope: swScope });\r\n                return [2 /*return*/, this.get(swScope)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Save the details for the fcm token for re-use at a later date.\r\n     * @param input A plain js object containing args to save.\r\n     */\r\n    TokenDetailsModel.prototype.saveTokenDetails = function (tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!tokenDetails.swScope) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                if (!tokenDetails.vapidKey) {\r\n                    throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n                }\r\n                if (!tokenDetails.endpoint || !tokenDetails.auth || !tokenDetails.p256dh) {\r\n                    throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n                }\r\n                if (!tokenDetails.fcmSenderId) {\r\n                    throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n                }\r\n                if (!tokenDetails.fcmToken) {\r\n                    throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n                }\r\n                validateInputs(tokenDetails);\r\n                return [2 /*return*/, this.put(tokenDetails)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes details of the current FCM token.\r\n     * It's returning a promise in case we need to move to an async\r\n     * method for deleting at a later date.\r\n     *\r\n     * @return Resolves once the FCM token details have been deleted and returns\r\n     * the deleted details.\r\n     */\r\n    TokenDetailsModel.prototype.deleteToken = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var details;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof token !== 'string' || token.length === 0) {\r\n                            return [2 /*return*/, Promise.reject(errorFactory.create(\"invalid-delete-token\" /* INVALID_DELETE_TOKEN */))];\r\n                        }\r\n                        return [4 /*yield*/, this.getTokenDetailsFromToken(token)];\r\n                    case 1:\r\n                        details = _a.sent();\r\n                        if (!details) {\r\n                            throw errorFactory.create(\"delete-token-not-found\" /* DELETE_TOKEN_NOT_FOUND */);\r\n                        }\r\n                        return [4 /*yield*/, this.delete(details.swScope)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, details];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return TokenDetailsModel;\r\n}(DbInterface));\r\n/**\r\n * This method takes an object and will check for known arguments and\r\n * validate the input.\r\n * @return Promise that resolves if input is valid, rejects otherwise.\r\n */\r\nfunction validateInputs(input) {\r\n    if (input.fcmToken) {\r\n        if (typeof input.fcmToken !== 'string' || input.fcmToken.length === 0) {\r\n            throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n        }\r\n    }\r\n    if (input.swScope) {\r\n        if (typeof input.swScope !== 'string' || input.swScope.length === 0) {\r\n            throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n        }\r\n    }\r\n    if (input.vapidKey) {\r\n        if (!(input.vapidKey instanceof Uint8Array) ||\r\n            input.vapidKey.length !== 65) {\r\n            throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n        }\r\n    }\r\n    if (input.endpoint) {\r\n        if (typeof input.endpoint !== 'string' || input.endpoint.length === 0) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.auth) {\r\n        if (!(input.auth instanceof ArrayBuffer)) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.p256dh) {\r\n        if (!(input.p256dh instanceof ArrayBuffer)) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.fcmSenderId) {\r\n        if (typeof input.fcmSenderId !== 'string' ||\r\n            input.fcmSenderId.length === 0) {\r\n            throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar UNCOMPRESSED_PUBLIC_KEY_SIZE = 65;\r\nvar VapidDetailsModel = /** @class */ (function (_super) {\r\n    __extends(VapidDetailsModel, _super);\r\n    function VapidDetailsModel() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.dbName = 'fcm_vapid_details_db';\r\n        _this.dbVersion = 1;\r\n        _this.objectStoreName = 'fcm_vapid_object_Store';\r\n        return _this;\r\n    }\r\n    VapidDetailsModel.prototype.onDbUpgrade = function (request) {\r\n        var db = request.result;\r\n        db.createObjectStore(this.objectStoreName, { keyPath: 'swScope' });\r\n    };\r\n    /**\r\n     * Given a service worker scope, this method will look up the vapid key\r\n     * in indexedDB.\r\n     */\r\n    VapidDetailsModel.prototype.getVapidFromSWScope = function (swScope) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof swScope !== 'string' || swScope.length === 0) {\r\n                            throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                        }\r\n                        return [4 /*yield*/, this.get(swScope)];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, result ? result.vapidKey : undefined];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Save a vapid key against a swScope for later date.\r\n     */\r\n    VapidDetailsModel.prototype.saveVapidDetails = function (swScope, vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var details;\r\n            return __generator(this, function (_a) {\r\n                if (typeof swScope !== 'string' || swScope.length === 0) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                if (vapidKey === null || vapidKey.length !== UNCOMPRESSED_PUBLIC_KEY_SIZE) {\r\n                    throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n                }\r\n                details = {\r\n                    swScope: swScope,\r\n                    vapidKey: vapidKey\r\n                };\r\n                return [2 /*return*/, this.put(details)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes details of the current FCM VAPID key for a SW scope.\r\n     * Resolves once the scope/vapid details have been deleted and returns the\r\n     * deleted vapid key.\r\n     */\r\n    VapidDetailsModel.prototype.deleteVapidDetails = function (swScope) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var vapidKey;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getVapidFromSWScope(swScope)];\r\n                    case 1:\r\n                        vapidKey = _a.sent();\r\n                        if (!vapidKey) {\r\n                            throw errorFactory.create(\"delete-scope-not-found\" /* DELETE_SCOPE_NOT_FOUND */);\r\n                        }\r\n                        return [4 /*yield*/, this.delete(swScope)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, vapidKey];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return VapidDetailsModel;\r\n}(DbInterface));\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Token should be refreshed once a week.\r\nvar TOKEN_EXPIRATION_MILLIS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nvar BaseController = /** @class */ (function () {\r\n    function BaseController(app) {\r\n        var _this = this;\r\n        this.app = app;\r\n        this.vapidDetailsModel = new VapidDetailsModel();\r\n        this.subscriptionManager = new SubscriptionManager();\r\n        if (!app.options.messagingSenderId ||\r\n            typeof app.options.messagingSenderId !== 'string') {\r\n            throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n        }\r\n        this.INTERNAL = {\r\n            delete: function () { return _this.delete(); }\r\n        };\r\n        this.tokenDetailsModel = new TokenDetailsModel(app);\r\n    }\r\n    BaseController.prototype.getToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var currentPermission, swReg, publicVapidKey, pushSubscription, tokenDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        currentPermission = this.getNotificationPermission_();\r\n                        if (currentPermission === 'denied') {\r\n                            throw errorFactory.create(\"notifications-blocked\" /* NOTIFICATIONS_BLOCKED */);\r\n                        }\r\n                        else if (currentPermission !== 'granted') {\r\n                            // We must wait for permission to be granted\r\n                            return [2 /*return*/, null];\r\n                        }\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        swReg = _a.sent();\r\n                        return [4 /*yield*/, this.getPublicVapidKey_()];\r\n                    case 2:\r\n                        publicVapidKey = _a.sent();\r\n                        return [4 /*yield*/, this.getPushSubscription(swReg, publicVapidKey)];\r\n                    case 3:\r\n                        pushSubscription = _a.sent();\r\n                        return [4 /*yield*/, this.tokenDetailsModel.getTokenDetailsFromSWScope(swReg.scope)];\r\n                    case 4:\r\n                        tokenDetails = _a.sent();\r\n                        if (tokenDetails) {\r\n                            return [2 /*return*/, this.manageExistingToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\r\n                        }\r\n                        return [2 /*return*/, this.getNewToken(swReg, pushSubscription, publicVapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * manageExistingToken is triggered if there's an existing FCM token in the\r\n     * database and it can take 3 different actions:\r\n     * 1) Retrieve the existing FCM token from the database.\r\n     * 2) If VAPID details have changed: Delete the existing token and create a\r\n     * new one with the new VAPID key.\r\n     * 3) If the database cache is invalidated: Send a request to FCM to update\r\n     * the token, and to check if the token is still valid on FCM-side.\r\n     */\r\n    BaseController.prototype.manageExistingToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var isTokenValid, now;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        isTokenValid = isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails);\r\n                        if (!isTokenValid) return [3 /*break*/, 1];\r\n                        now = Date.now();\r\n                        if (now < tokenDetails.createTime + TOKEN_EXPIRATION_MILLIS) {\r\n                            return [2 /*return*/, tokenDetails.fcmToken];\r\n                        }\r\n                        else {\r\n                            return [2 /*return*/, this.updateToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\r\n                        }\r\n                    case 1: \r\n                    // If the token is no longer valid (for example if the VAPID details\r\n                    // have changed), delete the existing token from the FCM client and server\r\n                    // database. No need to unsubscribe from the Service Worker as we have a\r\n                    // good push subscription that we'd like to use in getNewToken.\r\n                    return [4 /*yield*/, this.deleteTokenFromDB(tokenDetails.fcmToken)];\r\n                    case 2:\r\n                        // If the token is no longer valid (for example if the VAPID details\r\n                        // have changed), delete the existing token from the FCM client and server\r\n                        // database. No need to unsubscribe from the Service Worker as we have a\r\n                        // good push subscription that we'd like to use in getNewToken.\r\n                        _a.sent();\r\n                        return [2 /*return*/, this.getNewToken(swReg, pushSubscription, publicVapidKey)];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.updateToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var updatedToken, allDetails, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 6]);\r\n                        return [4 /*yield*/, this.subscriptionManager.updateToken(tokenDetails, this.app, pushSubscription, publicVapidKey)];\r\n                    case 1:\r\n                        updatedToken = _a.sent();\r\n                        allDetails = {\r\n                            swScope: swReg.scope,\r\n                            vapidKey: publicVapidKey,\r\n                            fcmSenderId: this.app.options.messagingSenderId,\r\n                            fcmToken: updatedToken,\r\n                            createTime: Date.now(),\r\n                            endpoint: pushSubscription.endpoint,\r\n                            auth: pushSubscription.getKey('auth'),\r\n                            p256dh: pushSubscription.getKey('p256dh')\r\n                        };\r\n                        return [4 /*yield*/, this.tokenDetailsModel.saveTokenDetails(allDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/, updatedToken];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        return [4 /*yield*/, this.deleteToken(tokenDetails.fcmToken)];\r\n                    case 5:\r\n                        _a.sent();\r\n                        throw e_1;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.getNewToken = function (swReg, pushSubscription, publicVapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newToken, allDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.subscriptionManager.getToken(this.app, pushSubscription, publicVapidKey)];\r\n                    case 1:\r\n                        newToken = _a.sent();\r\n                        allDetails = {\r\n                            swScope: swReg.scope,\r\n                            vapidKey: publicVapidKey,\r\n                            fcmSenderId: this.app.options.messagingSenderId,\r\n                            fcmToken: newToken,\r\n                            createTime: Date.now(),\r\n                            endpoint: pushSubscription.endpoint,\r\n                            auth: pushSubscription.getKey('auth'),\r\n                            p256dh: pushSubscription.getKey('p256dh')\r\n                        };\r\n                        return [4 /*yield*/, this.tokenDetailsModel.saveTokenDetails(allDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/, newToken];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes tokens that the token manager looks after,\r\n     * unsubscribes the token from FCM  and then unregisters the push\r\n     * subscription if it exists. It returns a promise that indicates\r\n     * whether or not the unsubscribe request was processed successfully.\r\n     */\r\n    BaseController.prototype.deleteToken = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var registration, pushSubscription;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: \r\n                    // Delete the token details from the database.\r\n                    return [4 /*yield*/, this.deleteTokenFromDB(token)];\r\n                    case 1:\r\n                        // Delete the token details from the database.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 2:\r\n                        registration = _a.sent();\r\n                        if (!registration) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, registration.pushManager.getSubscription()];\r\n                    case 3:\r\n                        pushSubscription = _a.sent();\r\n                        if (pushSubscription) {\r\n                            return [2 /*return*/, pushSubscription.unsubscribe()];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4: \r\n                    // If there's no SW, consider it a success.\r\n                    return [2 /*return*/, true];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method will delete the token from the client database, and make a\r\n     * call to FCM to remove it from the server DB. Does not temper with the\r\n     * push subscription.\r\n     */\r\n    BaseController.prototype.deleteTokenFromDB = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var tokenDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.tokenDetailsModel.deleteToken(token)];\r\n                    case 1:\r\n                        tokenDetails = _a.sent();\r\n                        return [4 /*yield*/, this.subscriptionManager.deleteToken(this.app, tokenDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Gets a PushSubscription for the current user.\r\n     */\r\n    BaseController.prototype.getPushSubscription = function (swRegistration, publicVapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var subscription;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                    case 1:\r\n                        subscription = _a.sent();\r\n                        if (subscription) {\r\n                            return [2 /*return*/, subscription];\r\n                        }\r\n                        return [2 /*return*/, swRegistration.pushManager.subscribe({\r\n                                userVisibleOnly: true,\r\n                                applicationServerKey: publicVapidKey\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    //\r\n    // The following methods should only be available in the window.\r\n    //\r\n    /**\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    BaseController.prototype.requestPermission = function () {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.useServiceWorker = function (_registration) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.usePublicVapidKey = function (_b64PublicKey) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.onMessage = function (_nextOrObserver, _error, _completed) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.onTokenRefresh = function (_nextOrObserver, _error, _completed) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    //\r\n    // The following methods are used by the service worker only.\r\n    //\r\n    BaseController.prototype.setBackgroundMessageHandler = function (_callback) {\r\n        throw errorFactory.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    //\r\n    // The following methods are used by the service themselves and not exposed\r\n    // publicly or not expected to be used by developers.\r\n    //\r\n    /**\r\n     * This method is required to adhere to the Firebase interface.\r\n     * It closes any currently open indexdb database connections.\r\n     */\r\n    BaseController.prototype.delete = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, Promise.all([\r\n                            this.tokenDetailsModel.closeDatabase(),\r\n                            this.vapidDetailsModel.closeDatabase()\r\n                        ])];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Returns the current Notification Permission state.\r\n     */\r\n    BaseController.prototype.getNotificationPermission_ = function () {\r\n        return Notification.permission;\r\n    };\r\n    BaseController.prototype.getTokenDetailsModel = function () {\r\n        return this.tokenDetailsModel;\r\n    };\r\n    BaseController.prototype.getVapidDetailsModel = function () {\r\n        return this.vapidDetailsModel;\r\n    };\r\n    // Visible for testing\r\n    // TODO: make protected\r\n    BaseController.prototype.getSubscriptionManager = function () {\r\n        return this.subscriptionManager;\r\n    };\r\n    return BaseController;\r\n}());\r\n/**\r\n * Checks if the tokenDetails match the details provided in the clients.\r\n */\r\nfunction isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails) {\r\n    if (!tokenDetails.vapidKey ||\r\n        !isArrayBufferEqual(publicVapidKey.buffer, tokenDetails.vapidKey.buffer)) {\r\n        return false;\r\n    }\r\n    var isEndpointEqual = pushSubscription.endpoint === tokenDetails.endpoint;\r\n    var isAuthEqual = isArrayBufferEqual(pushSubscription.getKey('auth'), tokenDetails.auth);\r\n    var isP256dhEqual = isArrayBufferEqual(pushSubscription.getKey('p256dh'), tokenDetails.p256dh);\r\n    return isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FCM_MSG = 'FCM_MSG';\r\nvar SwController = /** @class */ (function (_super) {\r\n    __extends(SwController, _super);\r\n    function SwController(app) {\r\n        var _this = _super.call(this, app) || this;\r\n        _this.bgMessageHandler = null;\r\n        self.addEventListener('push', function (e) {\r\n            _this.onPush(e);\r\n        });\r\n        self.addEventListener('pushsubscriptionchange', function (e) {\r\n            _this.onSubChange(e);\r\n        });\r\n        self.addEventListener('notificationclick', function (e) {\r\n            _this.onNotificationClick(e);\r\n        });\r\n        return _this;\r\n    }\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onPush = function (event) {\r\n        event.waitUntil(this.onPush_(event));\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onSubChange = function (event) {\r\n        event.waitUntil(this.onSubChange_(event));\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onNotificationClick = function (event) {\r\n        event.waitUntil(this.onNotificationClick_(event));\r\n    };\r\n    /**\r\n     * A handler for push events that shows notifications based on the content of\r\n     * the payload.\r\n     *\r\n     * The payload must be a JSON-encoded Object with a `notification` key. The\r\n     * value of the `notification` property will be used as the NotificationOptions\r\n     * object passed to showNotification. Additionally, the `title` property of the\r\n     * notification object will be used as the title.\r\n     *\r\n     * If there is no notification data in the payload then no notification will be\r\n     * shown.\r\n     */\r\n    SwController.prototype.onPush_ = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msgPayload, hasVisibleClients, notificationDetails, notificationTitle, reg, actions, maxActions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!event.data) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        try {\r\n                            msgPayload = event.data.json();\r\n                        }\r\n                        catch (err) {\r\n                            // Not JSON so not an FCM message\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, this.hasVisibleClients_()];\r\n                    case 1:\r\n                        hasVisibleClients = _a.sent();\r\n                        if (hasVisibleClients) {\r\n                            // App in foreground. Send to page.\r\n                            return [2 /*return*/, this.sendMessageToWindowClients_(msgPayload)];\r\n                        }\r\n                        notificationDetails = this.getNotificationData_(msgPayload);\r\n                        if (!notificationDetails) return [3 /*break*/, 3];\r\n                        notificationTitle = notificationDetails.title || '';\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 2:\r\n                        reg = _a.sent();\r\n                        actions = notificationDetails.actions;\r\n                        maxActions = Notification.maxActions;\r\n                        if (actions && maxActions && actions.length > maxActions) {\r\n                            console.warn(\"This browser only supports \" + maxActions + \" actions.\" +\r\n                                \"The remaining actions will not be displayed.\");\r\n                        }\r\n                        return [2 /*return*/, reg.showNotification(notificationTitle, notificationDetails)];\r\n                    case 3:\r\n                        if (!this.bgMessageHandler) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.bgMessageHandler(msgPayload)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onSubChange_ = function (_event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var registration, err_1, err_2, tokenDetailsModel, tokenDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        registration = _a.sent();\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        err_1 = _a.sent();\r\n                        throw errorFactory.create(\"unable-to-resubscribe\" /* UNABLE_TO_RESUBSCRIBE */, {\r\n                            errorInfo: err_1\r\n                        });\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 8]);\r\n                        return [4 /*yield*/, registration.pushManager.getSubscription()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 5:\r\n                        err_2 = _a.sent();\r\n                        tokenDetailsModel = this.getTokenDetailsModel();\r\n                        return [4 /*yield*/, tokenDetailsModel.getTokenDetailsFromSWScope(registration.scope)];\r\n                    case 6:\r\n                        tokenDetails = _a.sent();\r\n                        if (!tokenDetails) {\r\n                            // This should rarely occure, but could if indexedDB\r\n                            // is corrupted or wiped\r\n                            throw err_2;\r\n                        }\r\n                        // Attempt to delete the token if we know it's bad\r\n                        return [4 /*yield*/, this.deleteToken(tokenDetails.fcmToken)];\r\n                    case 7:\r\n                        // Attempt to delete the token if we know it's bad\r\n                        _a.sent();\r\n                        throw err_2;\r\n                    case 8: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onNotificationClick_ = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msgPayload, link, windowClient, internalMsg;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!event.notification ||\r\n                            !event.notification.data ||\r\n                            !event.notification.data[FCM_MSG]) {\r\n                            // Not an FCM notification, do nothing.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (event.action) {\r\n                            // User clicked on an action button.\r\n                            // This will allow devs to act on action button clicks by using a custom\r\n                            // onNotificationClick listener that they define.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Prevent other listeners from receiving the event\r\n                        event.stopImmediatePropagation();\r\n                        event.notification.close();\r\n                        msgPayload = event.notification.data[FCM_MSG];\r\n                        if (!msgPayload.notification) {\r\n                            // Nothing to do.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        link = (msgPayload.fcmOptions && msgPayload.fcmOptions.link) ||\r\n                            msgPayload.notification.click_action;\r\n                        if (!link) {\r\n                            if (msgPayload.data && FN_CAMPAIGN_ID in msgPayload.data) {\r\n                                link = self.location.origin;\r\n                            }\r\n                            else {\r\n                                // Nothing to do.\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        return [4 /*yield*/, this.getWindowClient_(link)];\r\n                    case 1:\r\n                        windowClient = _a.sent();\r\n                        if (!!windowClient) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, self.clients.openWindow(link)];\r\n                    case 2:\r\n                        // Unable to find window client so need to open one.\r\n                        windowClient = _a.sent();\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        return [4 /*yield*/, sleep(3000)];\r\n                    case 3:\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 4: return [4 /*yield*/, windowClient.focus()];\r\n                    case 5:\r\n                        windowClient = _a.sent();\r\n                        _a.label = 6;\r\n                    case 6:\r\n                        if (!windowClient) {\r\n                            // Window Client will not be returned if it's for a third party origin.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Delete notification and fcmOptions data from payload before sending to\r\n                        // the page.\r\n                        delete msgPayload.notification;\r\n                        delete msgPayload.fcmOptions;\r\n                        internalMsg = createNewMsg(MessageType.NOTIFICATION_CLICKED, msgPayload);\r\n                        // Attempt to send a message to the client to handle the data\r\n                        // Is affected by: https://github.com/slightlyoff/ServiceWorker/issues/728\r\n                        return [2 /*return*/, this.attemptToMessageClient_(windowClient, internalMsg)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.getNotificationData_ = function (msgPayload) {\r\n        var _a;\r\n        if (!msgPayload) {\r\n            return;\r\n        }\r\n        if (typeof msgPayload.notification !== 'object') {\r\n            return;\r\n        }\r\n        var notificationInformation = __assign({}, msgPayload.notification);\r\n        // Put the message payload under FCM_MSG name so we can identify the\r\n        // notification as being an FCM notification vs a notification from\r\n        // somewhere else (i.e. normal web push or developer generated\r\n        // notification).\r\n        notificationInformation.data = __assign(__assign({}, msgPayload.notification.data), (_a = {}, _a[FCM_MSG] = msgPayload, _a));\r\n        return notificationInformation;\r\n    };\r\n    /**\r\n     * Calling setBackgroundMessageHandler will opt in to some specific\r\n     * behaviours.\r\n     * 1.) If a notification doesn't need to be shown due to a window already\r\n     * being visible, then push messages will be sent to the page.\r\n     * 2.) If a notification needs to be shown, and the message contains no\r\n     * notification data this method will be called\r\n     * and the promise it returns will be passed to event.waitUntil.\r\n     * If you do not set this callback then all push messages will let and the\r\n     * developer can handle them in a their own 'push' event callback\r\n     *\r\n     * @param callback The callback to be called when a push message is received\r\n     * and a notification must be shown. The callback will be given the data from\r\n     * the push message.\r\n     */\r\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\r\n        if (!callback || typeof callback !== 'function') {\r\n            throw errorFactory.create(\"bg-handler-function-expected\" /* BG_HANDLER_FUNCTION_EXPECTED */);\r\n        }\r\n        this.bgMessageHandler = callback;\r\n    };\r\n    /**\r\n     * @param url The URL to look for when focusing a client.\r\n     * @return Returns an existing window client or a newly opened WindowClient.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.getWindowClient_ = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var parsedURL, clientList, suitableClient, i, parsedClientUrl;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        parsedURL = new URL(url, self.location.href).href;\r\n                        return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        suitableClient = null;\r\n                        for (i = 0; i < clientList.length; i++) {\r\n                            parsedClientUrl = new URL(clientList[i].url, self.location.href)\r\n                                .href;\r\n                            if (parsedClientUrl === parsedURL) {\r\n                                suitableClient = clientList[i];\r\n                                break;\r\n                            }\r\n                        }\r\n                        return [2 /*return*/, suitableClient];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This message will attempt to send the message to a window client.\r\n     * @param client The WindowClient to send the message to.\r\n     * @param message The message to send to the client.\r\n     * @returns Returns a promise that resolves after sending the message. This\r\n     * does not guarantee that the message was successfully received.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.attemptToMessageClient_ = function (client, message) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                // NOTE: This returns a promise in case this API is abstracted later on to\r\n                // do additional work\r\n                if (!client) {\r\n                    throw errorFactory.create(\"no-window-client-to-msg\" /* NO_WINDOW_CLIENT_TO_MSG */);\r\n                }\r\n                client.postMessage(message);\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @returns If there is currently a visible WindowClient, this method will\r\n     * resolve to true, otherwise false.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.hasVisibleClients_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var clientList;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        return [2 /*return*/, clientList.some(function (client) {\r\n                                return client.visibilityState === 'visible' &&\r\n                                    // Ignore chrome-extension clients as that matches the background pages\r\n                                    // of extensions, which are always considered visible.\r\n                                    !client.url.startsWith('chrome-extension://');\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param msgPayload The data from the push event that should be sent to all\r\n     * available pages.\r\n     * @returns Returns a promise that resolves once the message has been sent to\r\n     * all WindowClients.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.sendMessageToWindowClients_ = function (msgPayload) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var clientList, internalMsg;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        internalMsg = createNewMsg(MessageType.PUSH_MSG_RECEIVED, msgPayload);\r\n                        return [4 /*yield*/, Promise.all(clientList.map(function (client) {\r\n                                return _this.attemptToMessageClient_(client, internalMsg);\r\n                            }))];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will register the default service worker and return the registration.\r\n     * @return he service worker registration to be used for the push service.\r\n     */\r\n    SwController.prototype.getSWRegistration_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, self.registration];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will return the default VAPID key or the uint8array version of the\r\n     * public VAPID key provided by the developer.\r\n     */\r\n    SwController.prototype.getPublicVapidKey_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var swReg, vapidKeyFromDatabase;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        swReg = _a.sent();\r\n                        if (!swReg) {\r\n                            throw errorFactory.create(\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */);\r\n                        }\r\n                        return [4 /*yield*/, this.getVapidDetailsModel().getVapidFromSWScope(swReg.scope)];\r\n                    case 2:\r\n                        vapidKeyFromDatabase = _a.sent();\r\n                        if (vapidKeyFromDatabase == null) {\r\n                            return [2 /*return*/, DEFAULT_PUBLIC_VAPID_KEY];\r\n                        }\r\n                        return [2 /*return*/, vapidKeyFromDatabase];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SwController;\r\n}(BaseController));\r\nfunction getClientList() {\r\n    return self.clients.matchAll({\r\n        type: 'window',\r\n        includeUncontrolled: true\r\n        // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\r\n    });\r\n}\r\nfunction createNewMsg(msgType, msgData) {\r\n    return {\r\n        firebaseMessagingType: msgType,\r\n        firebaseMessagingData: msgData\r\n    };\r\n}\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WindowController = /** @class */ (function (_super) {\r\n    __extends(WindowController, _super);\r\n    /**\r\n     * A service that provides a MessagingService instance.\r\n     */\r\n    function WindowController(app) {\r\n        var _this = _super.call(this, app) || this;\r\n        _this.registrationToUse = null;\r\n        _this.publicVapidKeyToUse = null;\r\n        _this.messageObserver = null;\r\n        // @ts-ignore: Unused variable error, this is not implemented yet.\r\n        _this.tokenRefreshObserver = null;\r\n        _this.onMessageInternal = createSubscribe(function (observer) {\r\n            _this.messageObserver = observer;\r\n        });\r\n        _this.onTokenRefreshInternal = createSubscribe(function (observer) {\r\n            _this.tokenRefreshObserver = observer;\r\n        });\r\n        _this.setupSWMessageListener_();\r\n        return _this;\r\n    }\r\n    /**\r\n     * Request permission if it is not currently granted\r\n     *\r\n     * @return Resolves if the permission was granted, otherwise rejects\r\n     *\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    WindowController.prototype.requestPermission = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionResult;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (this.getNotificationPermission_() === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        permissionResult = _a.sent();\r\n                        if (permissionResult === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (permissionResult === 'denied') {\r\n                            throw errorFactory.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        else {\r\n                            throw errorFactory.create(\"permission-default\" /* PERMISSION_DEFAULT */);\r\n                        }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method allows a developer to override the default service worker and\r\n     * instead use a custom service worker.\r\n     *\r\n     * @param registration The service worker registration that should be used to\r\n     * receive the push messages.\r\n     */\r\n    WindowController.prototype.useServiceWorker = function (registration) {\r\n        if (!(registration instanceof ServiceWorkerRegistration)) {\r\n            throw errorFactory.create(\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */);\r\n        }\r\n        if (this.registrationToUse != null) {\r\n            throw errorFactory.create(\"use-sw-before-get-token\" /* USE_SW_BEFORE_GET_TOKEN */);\r\n        }\r\n        this.registrationToUse = registration;\r\n    };\r\n    /**\r\n     * This method allows a developer to override the default vapid key\r\n     * and instead use a custom VAPID public key.\r\n     *\r\n     * @param publicKey A URL safe base64 encoded string.\r\n     */\r\n    WindowController.prototype.usePublicVapidKey = function (publicKey) {\r\n        if (typeof publicKey !== 'string') {\r\n            throw errorFactory.create(\"invalid-public-vapid-key\" /* INVALID_PUBLIC_VAPID_KEY */);\r\n        }\r\n        if (this.publicVapidKeyToUse != null) {\r\n            throw errorFactory.create(\"use-public-key-before-get-token\" /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */);\r\n        }\r\n        var parsedKey = base64ToArrayBuffer(publicKey);\r\n        if (parsedKey.length !== 65) {\r\n            throw errorFactory.create(\"public-vapid-key-decryption-failed\" /* PUBLIC_KEY_DECRYPTION_FAILED */);\r\n        }\r\n        this.publicVapidKeyToUse = parsedKey;\r\n    };\r\n    /**\r\n     * @export\r\n     * @param nextOrObserver An observer object or a function triggered on\r\n     * message.\r\n     * @param error A function triggered on message error.\r\n     * @param completed function triggered when the observer is removed.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onMessage = function (nextOrObserver, error, completed) {\r\n        if (typeof nextOrObserver === 'function') {\r\n            return this.onMessageInternal(nextOrObserver, error, completed);\r\n        }\r\n        else {\r\n            return this.onMessageInternal(nextOrObserver);\r\n        }\r\n    };\r\n    /**\r\n     * @param nextOrObserver An observer object or a function triggered on token\r\n     * refresh.\r\n     * @param error A function triggered on token refresh error.\r\n     * @param completed function triggered when the observer is removed.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onTokenRefresh = function (nextOrObserver, error, completed) {\r\n        if (typeof nextOrObserver === 'function') {\r\n            return this.onTokenRefreshInternal(nextOrObserver, error, completed);\r\n        }\r\n        else {\r\n            return this.onTokenRefreshInternal(nextOrObserver);\r\n        }\r\n    };\r\n    /**\r\n     * Given a registration, wait for the service worker it relates to\r\n     * become activer\r\n     * @param registration Registration to wait for service worker to become active\r\n     * @return Wait for service worker registration to become active\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    WindowController.prototype.waitForRegistrationToActivate_ = function (registration) {\r\n        var serviceWorker = registration.installing || registration.waiting || registration.active;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!serviceWorker) {\r\n                // This is a rare scenario but has occured in firefox\r\n                reject(errorFactory.create(\"no-sw-in-reg\" /* NO_SW_IN_REG */));\r\n                return;\r\n            }\r\n            // Because the Promise function is called on next tick there is a\r\n            // small chance that the worker became active or redundant already.\r\n            if (serviceWorker.state === 'activated') {\r\n                resolve(registration);\r\n                return;\r\n            }\r\n            if (serviceWorker.state === 'redundant') {\r\n                reject(errorFactory.create(\"sw-reg-redundant\" /* SW_REG_REDUNDANT */));\r\n                return;\r\n            }\r\n            var stateChangeListener = function () {\r\n                if (serviceWorker.state === 'activated') {\r\n                    resolve(registration);\r\n                }\r\n                else if (serviceWorker.state === 'redundant') {\r\n                    reject(errorFactory.create(\"sw-reg-redundant\" /* SW_REG_REDUNDANT */));\r\n                }\r\n                else {\r\n                    // Return early and wait to next state change\r\n                    return;\r\n                }\r\n                serviceWorker.removeEventListener('statechange', stateChangeListener);\r\n            };\r\n            serviceWorker.addEventListener('statechange', stateChangeListener);\r\n        });\r\n    };\r\n    /**\r\n     * This will register the default service worker and return the registration\r\n     * @return The service worker registration to be used for the push service.\r\n     */\r\n    WindowController.prototype.getSWRegistration_ = function () {\r\n        var _this = this;\r\n        if (this.registrationToUse) {\r\n            return this.waitForRegistrationToActivate_(this.registrationToUse);\r\n        }\r\n        // Make the registration null so we know useServiceWorker will not\r\n        // use a new service worker as registrationToUse is no longer undefined\r\n        this.registrationToUse = null;\r\n        return navigator.serviceWorker\r\n            .register(DEFAULT_SW_PATH, {\r\n            scope: DEFAULT_SW_SCOPE\r\n        })\r\n            .catch(function (err) {\r\n            throw errorFactory.create(\"failed-serviceworker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n                browserErrorMessage: err.message\r\n            });\r\n        })\r\n            .then(function (registration) {\r\n            return _this.waitForRegistrationToActivate_(registration).then(function () {\r\n                _this.registrationToUse = registration;\r\n                // We update after activation due to an issue with Firefox v49 where\r\n                // a race condition occassionally causes the service worker to not\r\n                // install\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                registration.update();\r\n                return registration;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will return the default VAPID key or the uint8array version of the\r\n     * public VAPID key provided by the developer.\r\n     */\r\n    WindowController.prototype.getPublicVapidKey_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (this.publicVapidKeyToUse) {\r\n                    return [2 /*return*/, this.publicVapidKeyToUse];\r\n                }\r\n                return [2 /*return*/, DEFAULT_PUBLIC_VAPID_KEY];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method will set up a message listener to handle\r\n     * events from the service worker that should trigger\r\n     * events in the page.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    WindowController.prototype.setupSWMessageListener_ = function () {\r\n        var _this = this;\r\n        navigator.serviceWorker.addEventListener('message', function (event) {\r\n            if (!event.data ||\r\n                !event.data.firebaseMessagingType ||\r\n                !event.data.firebaseMessagingData) {\r\n                // Not a message from FCM\r\n                return;\r\n            }\r\n            var _a = event.data, firebaseMessagingType = _a.firebaseMessagingType, firebaseMessagingData = _a.firebaseMessagingData;\r\n            if (_this.messageObserver) {\r\n                _this.messageObserver.next(firebaseMessagingData);\r\n            }\r\n            var data = firebaseMessagingData.data;\r\n            if (data &&\r\n                FN_CAMPAIGN_ID in data &&\r\n                data[FN_CAMPAIGN_ANALYTICS_ENABLED] === '1') {\r\n                // This message has a campaign id, meaning it was sent using the FN Console.\r\n                // Analytics is enabled on this message, so we should log it.\r\n                var eventType = getEventType(firebaseMessagingType);\r\n                _this.app.INTERNAL.analytics.logEvent(eventType, \r\n                /* eslint-disable camelcase */\r\n                {\r\n                    message_name: data[FN_CAMPAIGN_NAME],\r\n                    message_id: data[FN_CAMPAIGN_ID],\r\n                    message_time: data[FN_CAMPAIGN_TIME],\r\n                    message_device_time: Math.floor(Date.now() / 1000)\r\n                }\r\n                /* eslint-enable camelcase */\r\n                );\r\n            }\r\n        }, false);\r\n    };\r\n    return WindowController;\r\n}(BaseController));\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_MSG_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerMessaging(instance) {\r\n    var messagingName = 'messaging';\r\n    var factoryMethod = function (app) {\r\n        if (!isSupported()) {\r\n            throw errorFactory.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n        }\r\n        if (self && 'ServiceWorkerGlobalScope' in self) {\r\n            // Running in ServiceWorker context\r\n            return new SwController(app);\r\n        }\r\n        else {\r\n            // Assume we are in the window context.\r\n            return new WindowController(app);\r\n        }\r\n    };\r\n    var namespaceExports = {\r\n        isSupported: isSupported\r\n    };\r\n    instance.INTERNAL.registerService(messagingName, factoryMethod, namespaceExports);\r\n}\r\nregisterMessaging(firebase);\r\nfunction isSupported() {\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return isSWControllerSupported();\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return isWindowControllerSupported();\r\n    }\r\n}\r\n/**\r\n * Checks to see if the required APIs exist.\r\n */\r\nfunction isWindowControllerSupported() {\r\n    return (navigator.cookieEnabled &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\r\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\r\nfunction isSWControllerSupported() {\r\n    return ('PushManager' in self &&\r\n        'Notification' in self &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n\nexport { isSupported, registerMessaging };\n//# sourceMappingURL=index.esm.js.map\n","import '@firebase/messaging';\n//# sourceMappingURL=index.esm.js.map\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.idb = {}));\n}(this, function (exports) { 'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function(db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n"]}